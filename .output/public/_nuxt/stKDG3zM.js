import{S as le,P as ce,W as ue,O as de,A as me,D as fe,a as he,M as ge,b as pe,j as we,d as ve,e as X,C as Se,V as xe,E as Me,f as ye,g as Q,Q as Pe,h as J,i as Te}from"./GFrmpgK8.js";import{E as Ee,R as ke,O as Ae}from"./00I9isl8.js";import{r as R,o as De,I as Le,t as Fe,x as be,v as Ce}from"./iXxArwze.js";const Re={class:"splash-container"},Z=50,K=20,ze=`
    uniform vec3 viewVector;
    uniform vec2 uResolution;
    uniform float uTime;
    varying vec2 vUv;
    varying float opacity;
    void main() {
      vUv = uv;
      vec4 mvPos = modelViewMatrix * vec4(position, 1.0);
      gl_Position = projectionMatrix * mvPos;
      vec3 nNormal = normalize(normalMatrix * normal);
      vec3 nView   = normalize(viewVector - mvPos.xyz);
      opacity = dot(nNormal, nView);
      opacity = 1.0 - abs(opacity * 1.3);
    }
  `,Be=`
    uniform vec3 uColor;
    uniform vec2 uResolution;
    uniform float uTime;
    varying vec2 vUv;
    varying float opacity;
    void main() {
      vec2 d = gl_FragCoord.xy / uResolution;
      vec3 fade = vec3(d.x, d.y, 1.0);
      vec3 c = mix(vec3(0.0), fade * uColor, opacity);
      gl_FragColor = vec4(c, 1.0);
    }
  `,Qe={__name:"ver3-1",setup(_e){const T=R(null),q=R("liquid"),U=R(!1),Y=R(!0),E=R(!0);let l,f,d,h,r,m,c,L,k,G,W,p=[],x=[],M=[],y=[],F=[],P=null,A=null,I=null,V=!1,w="idle",z=null;const s={centerBall:{maxStrength:1,minStrength:0,fadeDuration:5,fadeEasing:{type:"easeIn",power:.5}},timing:{baseShrinkDuration:3,flowShrinkDurationFactor:.2},growth:{speed:5,easeOutPower:.15,flowSpeedFactor:.1},wave:{frequency:1,amplitudeFactor:.3,phaseFactor:Math.PI*4}};function $(){return{shader:new ve({uniforms:{uResolution:{value:new xe(window.innerWidth,window.innerHeight)},uTime:{value:0},uColor:{value:new Se(0)},viewVector:{value:f.position}},vertexShader:ze,fragmentShader:Be,transparent:!0,side:X}),liquid:new we({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.33,thickness:1,envMap:null,envMapIntensity:50,side:X})}}function j(){new Me().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=ye;const n=L.fromEquirectangular(e).texture;L.dispose(),e.dispose(),console.log("本地 EXR 環境貼圖已載入並處理完成。"),l.environment=n,c&&c.liquid&&(c.liquid.envMap=n,c.liquid.needsUpdate=!0)},void 0,e=>{console.error("無法載入本地 EXR 環境貼圖:",e)})}function ee(e){if(!m)return;e.reset();const n=m.getElapsedTime(),a=new Q(.5,.5,.5),t=y.length;if(E.value&&ne(n),V){const i=re(n);i>.01&&e.addBall(a.x,a.y,a.z,i,K)}for(let i=0;i<t;i++){if(p[i]===void 0||n<p[i]||M[i]===void 0)continue;const o=M[i]/e.scale.x;let u=0,g=n-p[i];if(E.value){switch(w){case"growing":if(o>.001){const v=s.growth.speed*s.growth.flowSpeedFactor,S=o/(v/e.scale.x),b=S>0?Math.min(g/S,1):1;u=Math.pow(b,s.growth.easeOutPower)*o}else u=0;break;case"pauseAtEnd":u=o;break;case"shrinking":if(P!==null&&A!==null){const v=A-P,S=n-P,b=Math.min(S/v,1),C=Math.max(0,1-b);u=o*C}else u=o;break;case"pauseAtStart":u=.001;break;default:u=0;break}F[i]=w}else if(o>.001){const v=Math.min(g/(o/(s.growth.speed/e.scale.x)),1);u=Math.pow(v,s.growth.easeOutPower)*o}else u=0;if(u<=.001)continue;const B=x[i],D=y[i];if(!(!B||!D))for(let v=0;v<=Z;v++){const S=v/Z,b=Math.pow(S,D==="tt"?.25:1.25),C=J.lerp(D==="tt"?.1:.01,D==="tt"?.01:.1,b);let _=C;if(E.value){const oe=s.wave.amplitudeFactor*C,se=Math.sin(n*s.wave.frequency-S*s.wave.phaseFactor)*oe;_+=se,_=Math.max(_,0)}const O=B.clone().multiplyScalar(u*S).add(a);e.addBall(O.x,O.y,O.z,_,K)}}e.update()}function te(){fetch("/modelJson.json").then(e=>e.json()).then(e=>{console.log("讀取的設定:",e);const n=e.lineTypes.length;p=new Array(n),x=new Array(n),M=new Array(n),y=new Array(n),F=new Array(n);const a=(m==null?void 0:m.getElapsedTime())??0;for(let t=0;t<n;t++)y[t]=e.lineTypes[t],M[t]=e.currentTargetLengths[t],e.randomDirections[t]?x[t]=new Q(e.randomDirections[t].x,e.randomDirections[t].y,e.randomDirections[t].z):x[t]=null,p[t]=a-1e3,F[t]="growing";if(r&&e.cameraQuaternion){const t=new Pe(e.cameraQuaternion.x,e.cameraQuaternion.y,e.cameraQuaternion.z,e.cameraQuaternion.w);r.quaternion.set(0,0,0,1);const i=t.clone().invert();r.quaternion.premultiply(i),r.matrixWorldNeedsUpdate=!0,r.updateMatrixWorld(!0),r.matrixAutoUpdate=!1}console.log("模型設定已載入完成")}).catch(e=>{console.error("載入模型設定失敗:",e)})}function ne(e){if(!(!E.value||!m))if(w==="growing"&&I!==null){const n=y.length;let a=0,t=0;for(let o=0;o<n;o++){if(p[o]===void 0||M[o]===void 0)continue;t++;const u=M[o]/((r==null?void 0:r.scale.x)||1),g=e-(p[o]||e),B=s.growth.speed*s.growth.flowSpeedFactor,D=u/(B/((r==null?void 0:r.scale.x)||1)),v=D>0?Math.min(g/D,1):1;a+=v}(t>0?a/t:0)>=.99&&(w="pauseAtEnd",console.log("所有線條已生長完成，進入暫停狀態"),setTimeout(()=>{E.value&&ae()},1e3))}else w==="shrinking"&&P!==null&&A!==null&&e>=A&&(w="pauseAtStart",console.log("所有線條已收合完成，進入起始暫停狀態"),setTimeout(()=>{E.value&&ie()},1e3))}function ae(){if(!m)return;const e=m.getElapsedTime();console.log("所有線條同步收合"),w="shrinking",P=e,A=e+s.timing.baseShrinkDuration*s.timing.flowShrinkDurationFactor,V=!0}function ie(){var a;if(!m)return;const e=m.getElapsedTime(),n=y.length;console.log("所有線條同步生長"),w="growing",I=e,V=!1,z=null;for(let t=0;t<n;t++){if(p[t]===void 0)continue;x[t]||(x[t]=new Q),(a=x[t])==null||a.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize();const i=2,o=3.5;M[t]=J.randFloat(i,o),p[t]=e}}function re(e){if(!m)return 0;if(e===void 0&&(e=m.getElapsedTime()),w==="shrinking"){if(P===null||A===null)return 0;const n=A-P,a=e-P,t=Math.min(a/n,1);return s.centerBall.minStrength+t*(s.centerBall.maxStrength-s.centerBall.minStrength)}else if(w==="pauseAtStart"){if(z===null)return z=e,s.centerBall.maxStrength;const n=e-z,a=Math.min(n/s.centerBall.fadeDuration,1);let t;switch(s.centerBall.fadeEasing.type){case"easeIn":t=Math.pow(a,s.centerBall.fadeEasing.power);break;case"easeOut":t=1-Math.pow(1-a,s.centerBall.fadeEasing.power);break;case"linear":default:t=a;break}return s.centerBall.maxStrength*(1-t)}else return s.centerBall.minStrength}function H(){if(W=requestAnimationFrame(H),!(!r||!c||!f||!d||!l||!h)){if(ee(r),h.update(),q.value==="shader"&&!U.value){const e=m.getElapsedTime();c.shader.uniforms.uTime.value=e,c.shader.uniforms.viewVector.value=f.position}U.value&&k?k.render():d.render(l,f)}}function N(){var a,t;if(!f||!d||!c)return;const e=((a=T.value)==null?void 0:a.clientWidth)??window.innerWidth,n=((t=T.value)==null?void 0:t.clientHeight)??window.innerHeight;f.aspect=e/n,f.updateProjectionMatrix(),d.setSize(e,n),k&&k.setSize(e,n),c.shader&&c.shader.uniforms.uResolution.value.set(e,n)}return De(()=>{if(!T.value){console.error("Canvas container not found!");return}const e=T.value,n=e.clientWidth,a=e.clientHeight;l=new le,l.background=null,f=new ce(45,n/a,.1,1e3),f.position.set(0,0,25),f.lookAt(l.position),d=new ue({antialias:!0,alpha:!0}),d.setSize(n,a),d.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),e.appendChild(d.domElement),h=new de(f,d.domElement),h.enableDamping=!0,h.autoRotate=Y.value,h.autoRotateSpeed=5,h.enablePan=!1,h.enableZoom=!1,h.minPolarAngle=Math.PI/2,h.maxPolarAngle=Math.PI/2,h.minAzimuthAngle=-1/0,h.maxAzimuthAngle=1/0,l.add(new me(16777215,.3));const t=new fe(16777215,.5);t.position.set(5,10,7.5),l.add(t),L=new he(d),L.compileEquirectangularShader(),c=$(),r=new ge(200,c[q.value],!0,!0,1e5),r.isolation=300,r.scale.set(8,8,8),r.enableUvs=!1,r.enableColors=!1,l.add(r),k=new Ee(d),G=new ke(5,l,f),k.addPass(G);const i=new Ae;k.addPass(i),m=new Te,j(),te(),H(),E.value&&setTimeout(()=>{console.log("初始化流動動畫狀態...");const o=m.getElapsedTime();[...y],x.map(g=>g?{x:g.x,y:g.y,z:g.z}:null),[...M],[...p],f.position.clone(),f.quaternion.clone(),w="growing",I=o;const u=y.length;F.length=u;for(let g=0;g<u;g++)p[g]=o,F[g]="growing";r.reset(),r.material=c[q.value],console.log("流動動畫已初始化完成")},1e3),window.addEventListener("resize",N)}),Le(()=>{var e,n;cancelAnimationFrame(W),window.removeEventListener("resize",N),h&&h.dispose(),d&&d.dispose(),c&&((e=c.shader)==null||e.dispose(),(n=c.liquid)==null||n.dispose(),l!=null&&l.environment&&l.environment.dispose()),r&&(l==null||l.remove(r)),l&&l.traverse(a=>{var t;if(a instanceof pe){(t=a.geometry)==null||t.dispose();const i=a.material;Array.isArray(i)?i.forEach(o=>o.dispose()):i&&i.dispose()}}),L&&L.dispose(),T.value&&d&&T.value.removeChild(d.domElement),console.log("Three.js scene cleaned up.")}),(e,n)=>(Ce(),Fe("div",Re,[be("div",{ref_key:"canvasContainer",ref:T,class:"canvas-container"},null,512)]))}};export{Qe as default};
