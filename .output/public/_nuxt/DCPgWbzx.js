import{S as se,C as le,P as ce,W as ue,O as he,A as me,D as de,a as fe,M as ge,E as we,f as pe,b as Se,j as Le,e as ve,g as R,h as W,i as Me}from"./GFrmpgK8.js";import{r as Q,S as U,o as ke,I as xe,t as Pe,x as Ee,v as Fe}from"./iXxArwze.js";const Te={class:"splash-container"},_e={__name:"ver2-1",setup(Ce){const P=Q(null),u=U({startStrength:.1,endStrength:.01,minLength:2.5,maxLength:3.5,shrinkPower:.25,numLines:4}),m=U({startStrength:.01,endStrength:.1,minLength:2,maxLength:3,shrinkPower:1.25,numLines:3}),r=U({resolution:200,growthSpeed:5,growthEaseOutPower:.15,numSegments:50,subtract:20,flowGrowthSpeedFactor:.1,flowShrinkDurationFactor:.2,baseShrinkDuration:3,flowWaveFrequency:1,flowWaveAmplitudeFactor:.15,flowWavePhaseFactor:Math.PI*4,maxCenterBallStrength:2,minCenterBallStrength:0}),C=Q(!0);let s=null,p=null,c=null,v=null,l=null,d=null,M=null,T=null,V=null,g=[],f=[],k=[],E=[],A=[],x=null,F=null,N=null,I=!1,w="idle";function Y(){return new Le({color:16777215,metalness:.9,roughness:0,transparent:!0,opacity:.25,transmission:1,ior:1.5,thickness:1,envMapIntensity:1,side:ve})}function Z(){return new Promise((n,a)=>{new we().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=pe;const t=T.fromEquirectangular(e).texture;T.dispose(),e.dispose(),console.log("環境貼圖已載入"),s.environment=t,M&&(M.envMap=t,M.needsUpdate=!0),n(t)},void 0,e=>{console.error("無法載入環境貼圖:",e),a(e)})})}function $(){var t,o;if(!d||!l)return;const n=d.getElapsedTime(),a=u.numLines+m.numLines;g.length=a,f.length=a,k.length=a,E.length=a,A.length=a;let e=0;for(let i=0;i<u.numLines;i++)f[e]||(f[e]=new R),(t=f[e])==null||t.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),k[e]=W.randFloat(u.minLength,u.maxLength),E[e]="tt",g[e]=n,A[e]="growing",e++;for(let i=0;i<m.numLines;i++)f[e]||(f[e]=new R),(o=f[e])==null||o.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),k[e]=W.randFloat(m.minLength,m.maxLength),E[e]="th",g[e]=n,A[e]="growing",e++;l.reset()}function j(n){if(!d)return;n.reset();const a=d.getElapsedTime(),e=new R(.5,.5,.5),t=u.numLines+m.numLines;if(ee(a),I){const o=te(a);o>.01&&n.addBall(e.x,e.y,e.z,o,r.subtract)}for(let o=0;o<t;o++){if(g[o]===void 0||a<g[o]||k[o]===void 0)continue;const i=k[o]/n.scale.x;let h=0,B=a-g[o];if(C.value){switch(w){case"growing":if(i>.001){const S=r.growthSpeed*r.flowGrowthSpeedFactor,L=i/(S/n.scale.x),D=L>0?Math.min(B/L,1):1;h=Math.pow(D,r.growthEaseOutPower)*i}else h=0;break;case"pauseAtEnd":h=i;break;case"shrinking":if(x!==null&&F!==null){const S=F-x,L=a-x,D=Math.min(L/S,1),_=Math.max(0,1-D);h=i*_}else h=i;break;case"pauseAtStart":h=.001;break;default:h=0;break}A[o]=w}else if(i>.001){const S=Math.min(B/(i/(r.growthSpeed/n.scale.x)),1);h=Math.pow(S,r.growthEaseOutPower)*i}else h=0;if(h<=.001)continue;const z=f[o],b=E[o];if(!z||!b)continue;let y,O,q;b==="tt"?(y=u.startStrength,O=u.endStrength,q=u.shrinkPower):(y=m.startStrength,O=m.endStrength,q=m.shrinkPower);for(let S=0;S<=r.numSegments;S++){const L=S/r.numSegments,D=Math.pow(L,q),_=W.lerp(y,O,D);let G=_;if(C.value){const re=r.flowWaveAmplitudeFactor*_,oe=Math.sin(a*r.flowWaveFrequency-L*r.flowWavePhaseFactor)*re;G+=oe,G=Math.max(G,0)}const H=z.clone().multiplyScalar(h*L).add(e);n.addBall(H.x,H.y,H.z,G,r.subtract)}}n.update()}function ee(n){if(!(!C.value||!d))if(w==="growing"&&N!==null){const a=u.numLines+m.numLines;let e=0,t=0;for(let i=0;i<a;i++){if(g[i]===void 0||k[i]===void 0)continue;t++;const h=k[i]/((l==null?void 0:l.scale.x)||1),B=n-(g[i]||n),z=r.growthSpeed*r.flowGrowthSpeedFactor,b=h/(z/((l==null?void 0:l.scale.x)||1)),y=b>0?Math.min(B/b,1):1;e+=y}(t>0?e/t:0)>=.99&&(w="pauseAtEnd",console.log("所有線條已生長完成，進入暫停狀態"),setTimeout(()=>{C.value&&ne()},1e3))}else w==="shrinking"&&x!==null&&F!==null&&n>=F&&(w="pauseAtStart",console.log("所有線條已收合完成，進入起始暫停狀態"),setTimeout(()=>{C.value&&X()},1e3))}function ne(){if(!d)return;const n=d.getElapsedTime();console.log("所有線條同步收合"),w="shrinking",x=n,F=n+r.baseShrinkDuration*r.flowShrinkDurationFactor,I=!0}function X(){var e;if(!d)return;const n=d.getElapsedTime(),a=u.numLines+m.numLines;console.log("所有線條同步生長"),w="growing",N=n,I=!1;for(let t=0;t<a;t++){if(g[t]===void 0)continue;f[t]||(f[t]=new R),(e=f[t])==null||e.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),E[t]=t<u.numLines?"tt":"th";const o=E[t]==="tt"?u.minLength:m.minLength,i=E[t]==="tt"?u.maxLength:m.maxLength;k[t]=W.randFloat(o,i),g[t]=n}}function te(n){if(!d||x===null||F===null)return 0;if(n===void 0&&(n=d.getElapsedTime()),w==="shrinking"){const a=F-x,e=n-x,t=Math.min(e/a,1);return r.minCenterBallStrength+t*(r.maxCenterBallStrength-r.minCenterBallStrength)}else return w==="pauseAtStart"?r.maxCenterBallStrength:r.minCenterBallStrength}function J(){V=requestAnimationFrame(J),!(!l||!M||!p||!c||!s||!v)&&(j(l),v.update(),c.render(s,p))}function K(){var e,t;if(!p||!c)return;const n=((e=P.value)==null?void 0:e.clientWidth)??window.innerWidth,a=((t=P.value)==null?void 0:t.clientHeight)??window.innerHeight;p.aspect=n/a,p.updateProjectionMatrix(),c.setSize(n,a)}function ae(){if(!P.value)return console.error("Canvas container not found!"),!1;const n=P.value,a=n.clientWidth,e=n.clientHeight;s=new se,s.background=new le(1118481),p=new ce(45,a/e,.1,1e3),p.position.set(0,0,30),p.lookAt(s.position),c=new ue({antialias:!0}),c.setSize(a,e),c.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),n.appendChild(c.domElement),v=new he(p,c.domElement),v.enableDamping=!0,v.autoRotate=!0,v.autoRotateSpeed=2,s.add(new me(16777215,.3));const t=new de(16777215,.5);t.position.set(5,10,7.5),s.add(t),T=new fe(c),T.compileEquirectangularShader(),M=Y();const o=r.resolution*1.5;return l=new ge(r.resolution,M,!0,!0,1e5),l.isolation=o,l.scale.set(8,8,8),l.enableUvs=!1,l.enableColors=!1,s.add(l),d=new Me,!0}function ie(){cancelAnimationFrame(V),window.removeEventListener("resize",K),v&&v.dispose(),c&&c.dispose(),M&&(M.dispose(),s!=null&&s.environment&&s.environment.dispose()),l&&(s==null||s.remove(l)),s&&s.traverse(n=>{var a;if(n instanceof Se){(a=n.geometry)==null||a.dispose();const e=n.material;Array.isArray(e)?e.forEach(t=>t.dispose()):e&&e.dispose()}}),T&&T.dispose(),P.value&&c&&P.value.removeChild(c.domElement),console.log("Three.js場景已清理")}return ke(()=>{ae()&&(Z().then(()=>{console.log("環境貼圖載入完成")}).catch(n=>{console.error("環境貼圖載入失敗:",n)}),$(),setTimeout(()=>{X()},500),J(),window.addEventListener("resize",K))}),xe(()=>{ie()}),(n,a)=>(Fe(),Pe("div",Te,[Ee("div",{ref_key:"canvasContainer",ref:P,class:"canvas-container"},null,512)]))}};export{_e as default};
