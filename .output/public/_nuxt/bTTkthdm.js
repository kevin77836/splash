import{S as ve,C as N,P as Se,W as xe,O as ye,A as ke,D as Me,a as _e,M as be,b as Te,c as Pe,d as Ee,e as ee,V as Ce,E as De,f as Le,g as J,Q as Fe,h as te,i as Re}from"./GFrmpgK8.js";import{E as Ae,R as Be,O as qe}from"./00I9isl8.js";import{r as O,o as ze,I as Ve,t as Oe,x as l,y as X,K as P,v as Qe}from"./iXxArwze.js";const Ue={class:"splash-container"},Ge={id:"switchPanel",class:"control-panel switch-panel"},Ie={class:"switch-control-group"},We={class:"switch-label"},He={class:"switch"},Ne=["checked"],Je={class:"switch-control-group"},Xe={class:"switch-label"},$e={class:"switch"},Ke=["checked"],Ye={class:"switch-control-group"},Ze={class:"switch-label"},je={class:"switch"},et=["checked"],tt={class:"switch-control-group"},nt={class:"switch-label"},at={class:"switch"},ot=["checked"],ne=50,ae=20,it=`
    uniform vec3 viewVector;
    uniform vec2 uResolution;
    uniform float uTime;
    varying vec2 vUv;
    varying float opacity;
    void main() {
      vUv = uv;
      vec4 mvPos = modelViewMatrix * vec4(position, 1.0);
      gl_Position = projectionMatrix * mvPos;
      vec3 nNormal = normalize(normalMatrix * normal);
      vec3 nView   = normalize(viewVector - mvPos.xyz);
      opacity = dot(nNormal, nView);
      opacity = 1.0 - abs(opacity * 1.3);
    }
  `,st=`
    uniform vec3 uColor;
    uniform vec2 uResolution;
    uniform float uTime;
    varying vec2 vUv;
    varying float opacity;
    void main() {
      vec2 d = gl_FragCoord.xy / uResolution;
      vec3 fade = vec3(d.x, d.y, 1.0);
      vec3 c = mix(vec3(0.0), fade * uColor, opacity);
      gl_FragColor = vec4(c, 1.0);
    }
  `,ft={__name:"loadJson",setup(lt){const E=O(null),x=O("shader"),C=O(!1),D=O(!1),v=O(!1);let i,u,h,m,o,d,f,A,L,K,Y,p=[],k=[],M=[],y=[],B=[],F=null,q=null,_=null,T=null,Q=null,U=!1,w="idle",G=null;const r={centerBall:{maxStrength:1,minStrength:0,fadeDuration:5,fadeEasing:{type:"easeIn",power:.5}},timing:{baseShrinkDuration:3,flowShrinkDurationFactor:.2},growth:{speed:5,easeOutPower:.15,flowSpeedFactor:.1},wave:{frequency:1,amplitudeFactor:.3,phaseFactor:Math.PI*4}};function oe(){return{shader:new Ee({uniforms:{uResolution:{value:new Ce(window.innerWidth,window.innerHeight)},uTime:{value:0},uColor:{value:new N(0)},viewVector:{value:u.position}},vertexShader:it,fragmentShader:st,transparent:!0,side:ee}),liquid:new Pe({color:16777215,metalness:1,roughness:0,transparent:!0,opacity:.25,side:ee,envMap:null})}}function ie(){new De().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=Le;const t=A.fromEquirectangular(e).texture;A.dispose(),e.dispose(),console.log("本地 EXR 環境貼圖已載入並處理完成。"),i.environment=t,f&&f.liquid&&(f.liquid.envMap=t,f.liquid.needsUpdate=!0)},void 0,e=>{console.error("無法載入本地 EXR 環境貼圖:",e)})}function se(e){if(!d)return;e.reset();const t=d.getElapsedTime(),a=new J(.5,.5,.5),n=y.length;if(v.value&&fe(t),U){const s=ge(t);s>.01&&e.addBall(a.x,a.y,a.z,s,ae)}for(let s=0;s<n;s++){if(p[s]===void 0||t<p[s]||M[s]===void 0)continue;const c=M[s]/e.scale.x;let g=0,I=t-p[s];if(v.value){switch(w){case"growing":if(c>.001){const S=r.growth.speed*r.growth.flowSpeedFactor,b=c/(S/e.scale.x),z=b>0?Math.min(I/b,1):1;g=Math.pow(z,r.growth.easeOutPower)*c}else g=0;break;case"pauseAtEnd":g=c;break;case"shrinking":if(_!==null&&T!==null){const S=T-_,b=t-_,z=Math.min(b/S,1),V=Math.max(0,1-z);g=c*V}else g=c;break;case"pauseAtStart":g=.001;break;default:g=0;break}B[s]=w}else if(c>.001){const S=Math.min(I/(c/(r.growth.speed/e.scale.x)),1);g=Math.pow(S,r.growth.easeOutPower)*c}else g=0;if(g<=.001)continue;const W=k[s],R=y[s];if(!(!W||!R))for(let S=0;S<=ne;S++){const b=S/ne,z=Math.pow(b,R==="tt"?.25:1.25),V=te.lerp(R==="tt"?.1:.01,R==="tt"?.01:.1,z);let H=V;if(v.value){const pe=r.wave.amplitudeFactor*V,we=Math.sin(t*r.wave.frequency-b*r.wave.phaseFactor)*pe;H+=we,H=Math.max(H,0)}const $=W.clone().multiplyScalar(g*b).add(a);e.addBall($.x,$.y,$.z,H,ae)}}e.update()}function le(){fetch("/modelJson.json").then(e=>e.json()).then(e=>{console.log("讀取的設定:",e);const t=e.lineTypes.length;p=new Array(t),k=new Array(t),M=new Array(t),y=new Array(t),B=new Array(t);const a=(d==null?void 0:d.getElapsedTime())??0;for(let n=0;n<t;n++)y[n]=e.lineTypes[n],M[n]=e.currentTargetLengths[n],e.randomDirections[n]?k[n]=new J(e.randomDirections[n].x,e.randomDirections[n].y,e.randomDirections[n].z):k[n]=null,p[n]=a-1e3,B[n]="growing";if(o&&e.cameraQuaternion){const n=new Fe(e.cameraQuaternion.x,e.cameraQuaternion.y,e.cameraQuaternion.z,e.cameraQuaternion.w);o.quaternion.set(0,0,0,1);const s=n.clone().invert();o.quaternion.premultiply(s),o.matrixWorldNeedsUpdate=!0,o.updateMatrixWorld(!0),o.matrixAutoUpdate=!1}console.log("模型設定已載入完成")}).catch(e=>{console.error("載入模型設定失敗:",e)})}function re(){!o||!i||(x.value==="shader"?(x.value="liquid",i.background instanceof N&&i.background.set(1118481)):(x.value="shader",i.background instanceof N&&i.background.set(16777215)),o.material=f[x.value],console.log(`材質已切換為: ${x.value}, 背景顏色已更新.`))}function ce(){!o||!i||(C.value=!C.value,console.log(`像素化狀態已切換為: ${C.value}`))}function ue(){m&&(D.value=!D.value,m.autoRotate=D.value,m.autoRotateSpeed=5,console.log(`自動旋轉狀態已切換為: ${D.value}`))}function de(){if(!(!d||!o||!u||!m)){if(v.value)v.value=!1,w="idle",_=null,T=null,Q=null,U=!1,console.log("流動動畫已停止，正在恢復狀態..."),F?(y=[...F.lineTypes],k=F.randomDirections.map(e=>e?new J(e.x,e.y,e.z):null),M=[...F.currentTargetLengths],p=[...F.lineStartTimes],B=y.map(()=>"growing"),console.log("線條狀態已恢復"),F=null):console.warn("找不到保存的狀態來恢復。"),q?(u.position.copy(q.position),u.quaternion.copy(q.quaternion),m.update(),console.log("相機狀態已恢復"),q=null):console.warn("找不到保存的相機狀態來恢復。"),o.reset();else{console.log("開始流動動畫，正在保存當前狀態..."),F={lineTypes:[...y],randomDirections:k.map(a=>a?{x:a.x,y:a.y,z:a.z}:null),currentTargetLengths:[...M],lineStartTimes:[...p]},q={position:u.position.clone(),quaternion:u.quaternion.clone()},console.log("狀態已保存。"),v.value=!0,w="growing",Q=d.getElapsedTime();const e=d.getElapsedTime(),t=y.length;B.length=t,console.log("所有線條同時開始生長。");for(let a=0;a<t;a++)p[a]=e,B[a]="growing";o.reset()}o.material=f[x.value]}}function fe(e){if(!(!v.value||!d))if(w==="growing"&&Q!==null){const t=y.length;let a=0,n=0;for(let c=0;c<t;c++){if(p[c]===void 0||M[c]===void 0)continue;n++;const g=M[c]/((o==null?void 0:o.scale.x)||1),I=e-(p[c]||e),W=r.growth.speed*r.growth.flowSpeedFactor,R=g/(W/((o==null?void 0:o.scale.x)||1)),S=R>0?Math.min(I/R,1):1;a+=S}(n>0?a/n:0)>=.99&&(w="pauseAtEnd",console.log("所有線條已生長完成，進入暫停狀態"),setTimeout(()=>{v.value&&he()},1e3))}else w==="shrinking"&&_!==null&&T!==null&&e>=T&&(w="pauseAtStart",console.log("所有線條已收合完成，進入起始暫停狀態"),setTimeout(()=>{v.value&&me()},1e3))}function he(){if(!d)return;const e=d.getElapsedTime();console.log("所有線條同步收合"),w="shrinking",_=e,T=e+r.timing.baseShrinkDuration*r.timing.flowShrinkDurationFactor,U=!0}function me(){var a;if(!d)return;const e=d.getElapsedTime(),t=y.length;console.log("所有線條同步生長"),w="growing",Q=e,U=!1,G=null;for(let n=0;n<t;n++){if(p[n]===void 0)continue;k[n]||(k[n]=new J),(a=k[n])==null||a.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize();const s=2,c=3.5;M[n]=te.randFloat(s,c),p[n]=e}}function ge(e){if(!d)return 0;if(e===void 0&&(e=d.getElapsedTime()),w==="shrinking"){if(_===null||T===null)return 0;const t=T-_,a=e-_,n=Math.min(a/t,1);return r.centerBall.minStrength+n*(r.centerBall.maxStrength-r.centerBall.minStrength)}else if(w==="pauseAtStart"){if(G===null)return G=e,r.centerBall.maxStrength;const t=e-G,a=Math.min(t/r.centerBall.fadeDuration,1);let n;switch(r.centerBall.fadeEasing.type){case"easeIn":n=Math.pow(a,r.centerBall.fadeEasing.power);break;case"easeOut":n=1-Math.pow(1-a,r.centerBall.fadeEasing.power);break;case"linear":default:n=a;break}return r.centerBall.maxStrength*(1-n)}else return r.centerBall.minStrength}function Z(){if(Y=requestAnimationFrame(Z),!(!o||!f||!u||!h||!i||!m)){if(se(o),m.update(),x.value==="shader"&&!C.value){const e=d.getElapsedTime();f.shader.uniforms.uTime.value=e,f.shader.uniforms.viewVector.value=u.position}C.value&&L?L.render():h.render(i,u)}}function j(){var a,n;if(!u||!h||!f)return;const e=((a=E.value)==null?void 0:a.clientWidth)??window.innerWidth,t=((n=E.value)==null?void 0:n.clientHeight)??window.innerHeight;u.aspect=e/t,u.updateProjectionMatrix(),h.setSize(e,t),L&&L.setSize(e,t),f.shader&&f.shader.uniforms.uResolution.value.set(e,t)}return ze(()=>{if(!E.value){console.error("Canvas container not found!");return}const e=E.value,t=e.clientWidth,a=e.clientHeight;i=new ve,i.background=new N(16777215),u=new Se(45,t/a,.1,1e3),u.position.set(0,0,30),u.lookAt(i.position),h=new xe({antialias:!0}),h.setSize(t,a),h.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),e.appendChild(h.domElement),m=new ye(u,h.domElement),m.enableDamping=!0,m.autoRotate=D.value,m.autoRotateSpeed=5,i.add(new ke(16777215,.3));const n=new Me(16777215,.5);n.position.set(5,10,7.5),i.add(n),A=new _e(h),A.compileEquirectangularShader(),f=oe(),o=new be(200,f[x.value],!0,!0,1e5),o.isolation=300,o.scale.set(8,8,8),o.enableUvs=!1,o.enableColors=!1,i.add(o),L=new Ae(h),K=new Be(5,i,u),L.addPass(K);const s=new qe;L.addPass(s),d=new Re,ie(),le(),Z(),window.addEventListener("resize",j)}),Ve(()=>{var e,t;cancelAnimationFrame(Y),window.removeEventListener("resize",j),m&&m.dispose(),h&&h.dispose(),f&&((e=f.shader)==null||e.dispose(),(t=f.liquid)==null||t.dispose(),i!=null&&i.environment&&i.environment.dispose()),o&&(i==null||i.remove(o)),i&&i.traverse(a=>{var n;if(a instanceof Te){(n=a.geometry)==null||n.dispose();const s=a.material;Array.isArray(s)?s.forEach(c=>c.dispose()):s&&s.dispose()}}),A&&A.dispose(),E.value&&h&&E.value.removeChild(h.domElement),console.log("Three.js scene cleaned up.")}),(e,t)=>(Qe(),Oe("div",Ue,[l("div",{ref_key:"canvasContainer",ref:E,class:"canvas-container"},null,512),l("div",Ge,[t[4]||(t[4]=l("div",{class:"panel-title"},"效果切換",-1)),l("div",Ie,[l("label",We,X(P(x)==="shader"?"描邊材質":"液體材質"),1),l("label",He,[l("input",{type:"checkbox",checked:P(x)==="liquid",onChange:re},null,40,Ne),t[0]||(t[0]=l("span",{class:"slider round"},null,-1))])]),l("div",Je,[l("label",Xe,X(P(v)?"流動中":"靜止"),1),l("label",$e,[l("input",{type:"checkbox",checked:P(v),onChange:de},null,40,Ke),t[1]||(t[1]=l("span",{class:"slider round"},null,-1))])]),l("div",Ye,[l("label",Ze,X(P(C)?"像素化":"正常"),1),l("label",je,[l("input",{type:"checkbox",checked:P(C),onChange:ce},null,40,et),t[2]||(t[2]=l("span",{class:"slider round"},null,-1))])]),l("div",tt,[l("label",nt,X(P(D)?"自動旋轉中":"靜止"),1),l("label",at,[l("input",{type:"checkbox",checked:P(D),onChange:ue},null,40,ot),t[3]||(t[3]=l("span",{class:"slider round"},null,-1))])])])]))}};export{ft as default};
