import{S as re,P as se,W as ie,O as oe,A as le,D as ce,a as ue,M as de,E as pe,f as me,b as he,c as fe,e as ge,g as T,Q as we,h as P,i as Se}from"./Cx5nvXSb.js";import{r as ye,o as Me,I as ve,t as Ee,x as ke,v as Te}from"./DcyKddeJ.js";const xe={class:"splash-container"},be={__name:"loadJson-2",setup(Ae){const v=ye(null),g={segments:50,subtract:20,resolution:200,isolation:300,scale:8,randomRange:2,lineRange:{min:2,max:3.5}};let u,S,d,y,i,m,h,E,x,s={startTimes:[],directions:[],lengths:[],types:[],states:[]};const l={state:"idle",shrinkStart:null,shrinkEnd:null,growStart:null,centerBallVisible:!1,ballFadeStart:null},M={centerBall:{max:1,min:0,fadeDuration:5,easing:{type:"easeIn",power:.5}},timing:{shrinkBase:3,shrinkFactor:.2},growth:{speed:5,easePower:.15,speedFactor:.1},wave:{frequency:1,amplitude:.3,phase:Math.PI*4},render:{pixelRatio:1.5,rotateSpeed:5}};function b(){return new fe({color:16777215,metalness:1,roughness:0,transparent:!0,opacity:.25,side:ge,envMap:null})}function D(){return new Promise((e,t)=>{new pe().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",n=>{n.mapping=me;const a=E.fromEquirectangular(n).texture;E.dispose(),n.dispose(),u.environment=a,h!=null&&h.liquid&&(h.liquid.envMap=a,h.liquid.needsUpdate=!0),e(a)},void 0,n=>{console.error("環境貼圖載入失敗:",n),t(n)})})}function F(e){if(!m)return;e.reset();const t=m.getElapsedTime(),n=new T(.5,.5,.5);V(t),_(e,n,t),B(e,n,t),e.update()}function _(e,t,n){const a=q(n);a>.01?(e.addBall(t.x,t.y,t.z,a,g.subtract),l.centerBallVisible=!0):l.centerBallVisible=!1}function q(e){const{state:t,shrinkStart:n,shrinkEnd:a,ballFadeStart:r}=l,{min:c,max:o,fadeDuration:f,easing:w}=M.centerBall;if(t==="shrinking"&&n!==null&&a!==null){const p=a-n,k=Math.min((e-n)/p,1);return c+k*(o-c)}else if(t==="pauseAtStart"){if(r===null)return l.ballFadeStart=e,o;const p=Math.min((e-r)/f,1),k=J(p,w);return o*(1-k)}return c}function B(e,t,n){const a=s.types.length;for(let r=0;r<a;r++){if(!C(r,n))continue;const c=s.directions[r],o=s.types[r],f=s.lengths[r]/e.scale.x,w=n-s.startTimes[r],p=L(f,w,e.scale.x);p<=.001||!c||!o||z(e,p,c,o,t,n)}}function C(e,t){return s.startTimes[e]!==void 0&&t>=s.startTimes[e]&&s.lengths[e]!==void 0}function L(e,t,n){if(e<=.001)return 0;const{state:a,shrinkStart:r,shrinkEnd:c}=l,{speed:o,easePower:f,speedFactor:w}=M.growth,p=m.getElapsedTime();switch(a){case"growing":const k=o*w,ee=e/(k/n),te=Math.min(t/ee,1);return Math.pow(te,f)*e;case"pauseAtEnd":return e;case"shrinking":if(r!==null&&c!==null){const ne=c-r,ae=Math.min((p-r)/ne,1);return e*(1-ae)}return e;case"pauseAtStart":return .001;default:return 0}}function z(e,t,n,a,r,c){for(let o=0;o<=g.segments;o++){const f=o/g.segments,w=Q(f,a,c),p=I(f,t,n,r);e.addBall(p.x,p.y,p.z,w,g.subtract)}}function Q(e,t,n){const a=t==="tt",r=Math.pow(e,a?.25:1.25),c=P.lerp(a?.1:.01,a?.01:.1,r),{frequency:o,amplitude:f,phase:w}=M.wave,p=Math.sin(n*o-e*w)*f*c;return Math.max(c+p,0)}function I(e,t,n,a){return n.clone().multiplyScalar(t*e).add(a)}function V(e){const{state:t,growStart:n,shrinkStart:a,shrinkEnd:r}=l;t==="growing"&&n!==null?G(e)>=.99&&(l.state="pauseAtEnd",console.log("生長完成，暫停中"),setTimeout(O,1e3)):t==="shrinking"&&a!==null&&r!==null&&e>=r&&(l.state="pauseAtStart",console.log("收縮完成，暫停中"),setTimeout(U,1e3)),W()}function W(){const e=s.states.length,t=l.state;for(let n=0;n<e;n++)s.states[n]=t}function G(e){const t=s.types.length;let n=0,a=0;for(let r=0;r<t;r++){if(!s.startTimes[r]||!s.lengths[r])continue;a++;const c=s.lengths[r]/((i==null?void 0:i.scale.x)||1),o=e-(s.startTimes[r]||e),f=M.growth.speed*M.growth.speedFactor,w=c/(f/((i==null?void 0:i.scale.x)||1));n+=Math.min(o/w,1)}return a>0?n/a:0}function O(){if(!m)return;const e=m.getElapsedTime();l.state="shrinking",l.shrinkStart=e,l.shrinkEnd=e+M.timing.shrinkBase*M.timing.shrinkFactor,l.centerBallVisible=!0,l.ballFadeStart=null,console.log("開始收縮，顯示中心球體")}function U(){if(!m)return;const e=m.getElapsedTime();l.state="growing",l.growStart=e,l.centerBallVisible=!1,l.ballFadeStart=null,H(e),console.log("開始生長，隱藏中心球體")}function H(e){const t=s.types.length,{min:n,max:a}=g.lineRange;for(let r=0;r<t;r++){if(s.startTimes[r]===void 0)continue;s.directions[r]||(s.directions[r]=new T);const c=s.directions[r],o=g.randomRange;c.set(Math.random()*o-o/2,Math.random()*o-o/2,Math.random()*o-o/2).normalize(),s.lengths[r]=P.randFloat(n,a),s.startTimes[r]=e}}function J(e,t){switch(t.type){case"easeIn":return Math.pow(e,t.power);case"easeOut":return 1-Math.pow(1-e,t.power);default:return e}}function N(){return fetch("/modelJson.json").then(e=>e.json()).then(e=>(X(e),Z(e),K(),e)).catch(e=>{throw console.error("模型設定載入失敗:",e),e})}function X(e){const t=e.lineTypes.length,n=(m==null?void 0:m.getElapsedTime())??0;s={startTimes:new Array(t),directions:new Array(t),lengths:new Array(t),types:new Array(t),states:new Array(t)};for(let a=0;a<t;a++)s.types[a]=e.lineTypes[a],s.lengths[a]=e.currentTargetLengths[a],e.randomDirections[a]&&(s.directions[a]=new T(e.randomDirections[a].x,e.randomDirections[a].y,e.randomDirections[a].z)),s.startTimes[a]=n-1e3,s.states[a]="growing"}function Z(e){if(!i||!e.cameraQuaternion)return;const t=new we(e.cameraQuaternion.x,e.cameraQuaternion.y,e.cameraQuaternion.z,e.cameraQuaternion.w);i.quaternion.set(0,0,0,1);const n=t.clone().invert();i.quaternion.premultiply(n),i.matrixWorldNeedsUpdate=!0,i.updateMatrixWorld(!0),i.matrixAutoUpdate=!1}function K(){l.state="growing",l.growStart=m.getElapsedTime(),i&&i.reset()}function A(){x=requestAnimationFrame(A),Y()&&(F(i),y.update(),d.render(u,S))}function Y(){return i&&h&&S&&d&&u&&y}function R(){var n,a;if(!S||!d)return;const e=((n=v.value)==null?void 0:n.clientWidth)??window.innerWidth,t=((a=v.value)==null?void 0:a.clientHeight)??window.innerHeight;S.aspect=e/t,S.updateProjectionMatrix(),d.setSize(e,t)}function $(){if(!v.value)return console.error("找不到畫布容器!"),!1;const e=v.value,t=e.clientWidth,n=e.clientHeight;u=new re,u.background=null,S=new se(45,t/n,.1,1e3),S.position.set(0,0,30),S.lookAt(0,0,0),d=new ie({antialias:!0,alpha:!0}),d.setSize(t,n),d.setPixelRatio(Math.min(window.devicePixelRatio,M.render.pixelRatio)),e.appendChild(d.domElement),y=new oe(S,d.domElement),y.enableDamping=!0,y.autoRotate=!0,y.autoRotateSpeed=M.render.rotateSpeed,y.enableZoom=!1,u.add(new le(16777215,.3));const a=new ce(16777215,.5);return a.position.set(5,10,7.5),u.add(a),E=new ue(d),E.compileEquirectangularShader(),h={liquid:b()},i=new de(g.resolution,h.liquid,!0,!0,1e5),i.isolation=g.isolation,i.scale.set(g.scale,g.scale,g.scale),i.enableUvs=!1,i.enableColors=!1,u.add(i),m=new Se,!0}function j(){cancelAnimationFrame(x),window.removeEventListener("resize",R),y&&y.dispose(),d&&d.dispose(),h!=null&&h.liquid&&(h.liquid.dispose(),u!=null&&u.environment&&u.environment.dispose()),i&&(u==null||u.remove(i)),u&&u.traverse(e=>{if(e instanceof he){e.geometry&&e.geometry.dispose();const t=e.material;Array.isArray(t)?t.forEach(n=>n.dispose()):t&&t.dispose()}}),E&&E.dispose(),v.value&&d&&v.value.removeChild(d.domElement)}return Me(async()=>{if($())try{await Promise.all([D(),N()]),A(),window.addEventListener("resize",R)}catch(e){console.error("初始化失敗:",e)}}),ve(()=>{j()}),(e,t)=>(Te(),Ee("div",xe,[ke("div",{ref_key:"canvasContainer",ref:v,class:"canvas-container"},null,512)]))}};export{be as default};
