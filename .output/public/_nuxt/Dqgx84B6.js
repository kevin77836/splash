import{S as Se,P as Me,W as ye,O as xe,A as Pe,D as ke,a as Ee,M as Te,b as K,j as Y,d as De,e as U,C as Ae,V as Fe,E as be,f as Le,k as ze,g as I,Q as Ce,h as $,i as Re}from"./GFrmpgK8.js";import{E as Be,R as _e,O as qe}from"./00I9isl8.js";import{r as C,o as Ie,I as Oe,t as Ve,x as b,O as Ge,v as Qe}from"./B_MDMm1d.js";const Ue={class:"splash-container"},j=50,ee=20,We=`
  uniform vec3 viewVector;
  uniform vec2 uResolution;
  uniform float uTime;
  varying vec2 vUv;
  varying float opacity;
  void main() {
    vUv = uv;
    vec4 mvPos = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * mvPos;
    vec3 nNormal = normalize(normalMatrix * normal);
    vec3 nView   = normalize(viewVector - mvPos.xyz);
    opacity = dot(nNormal, nView);
    opacity = 1.0 - abs(opacity * 1.3);
  }
`,He=`
  uniform vec3 uColor;
  uniform vec2 uResolution;
  uniform float uTime;
  varying vec2 vUv;
  varying float opacity;
  void main() {
    vec2 d = gl_FragCoord.xy / uResolution;
    vec3 fade = vec3(d.x, d.y, 1.0);
    vec3 c = mix(vec3(0.0), fade * uColor, opacity);
    gl_FragColor = vec4(c, 1.0);
  }
`,Ye={__name:"ver4",setup(Ne){const x=C(null),W=C("liquid"),H=C(!1),te=C(!0),y=C(!0);let s,h,d,f,l,u,m,D,P,N,X,A=[],w=[],k=[],E=[],F=[],O=[],p=null,S=null,V=null,G=!1,g="idle",R=null;const ne={color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.33,thickness:1,envMapIntensity:50,side:U},i={centerBall:{maxStrength:1,minStrength:0,fadeDuration:5,fadeEasing:{type:"easeIn",power:.5}},shootingSpheres:{count:12,radius:.15,speed:3,maxDistance:8,geometry:{segments:16,rings:16}},timing:{baseShrinkDuration:3,flowShrinkDurationFactor:.2},growth:{speed:5,easeOutPower:.15,flowSpeedFactor:.1},wave:{frequency:1,amplitudeFactor:.3,phaseFactor:Math.PI*4}};function ae(){return{shader:new De({uniforms:{uResolution:{value:new Fe(window.innerWidth,window.innerHeight)},uTime:{value:0},uColor:{value:new Ae(0)},viewVector:{value:h.position}},vertexShader:We,fragmentShader:He,transparent:!0,side:U}),liquid:new Y({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.33,thickness:1,envMap:null,envMapIntensity:50,side:U})}}function ie(){new be().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=Le;const n=D.fromEquirectangular(e).texture;D.dispose(),e.dispose(),console.log("本地 EXR 環境貼圖已載入並處理完成。"),s.environment=n,m&&m.liquid&&(m.liquid.envMap=n,m.liquid.needsUpdate=!0)},void 0,e=>{console.error("無法載入本地 EXR 環境貼圖:",e)})}function re(e){if(!u)return;e.reset();const n=u.getElapsedTime(),a=new I(.5,.5,.5),t=F.length;if(y.value&&se(n),G){const r=ue(n);r>.01&&e.addBall(a.x,a.y,a.z,r,ee)}for(let r=0;r<t;r++){if(w[r]===void 0||n<w[r]||E[r]===void 0)continue;const o=E[r]/e.scale.x;let c=0,B=n-w[r];if(y.value){switch(g){case"growing":if(o>.001){const v=i.growth.speed*i.growth.flowSpeedFactor,M=o/(v/e.scale.x),L=M>0?Math.min(B/M,1):1;c=Math.pow(L,i.growth.easeOutPower)*o}else c=0;break;case"pauseAtEnd":c=o;break;case"shrinking":if(p!==null&&S!==null){const v=S-p,M=n-p,L=Math.min(M/v,1),z=Math.max(0,1-L);c=o*z}else c=o;break;case"pauseAtStart":c=.001;break;default:c=0;break}O[r]=g}else if(o>.001){const v=Math.min(B/(o/(i.growth.speed/e.scale.x)),1);c=Math.pow(v,i.growth.easeOutPower)*o}else c=0;if(c<=.001)continue;const _=k[r],T=F[r];if(!(!_||!T))for(let v=0;v<=j;v++){const M=v/j,L=Math.pow(M,T==="tt"?.25:1.25),z=$.lerp(T==="tt"?.1:.01,T==="tt"?.01:.1,L);let q=z;if(y.value){const ve=i.wave.amplitudeFactor*z,we=Math.sin(n*i.wave.frequency-M*i.wave.phaseFactor)*ve;q+=we,q=Math.max(q,0)}const Q=_.clone().multiplyScalar(c*M).add(a);e.addBall(Q.x,Q.y,Q.z,q,ee)}}e.update()}function oe(){fetch("/modelJson.json").then(e=>e.json()).then(e=>{console.log("讀取的設定:",e);const n=e.lineTypes.length;w=new Array(n),k=new Array(n),E=new Array(n),F=new Array(n),O=new Array(n);const a=(u==null?void 0:u.getElapsedTime())??0;for(let t=0;t<n;t++)F[t]=e.lineTypes[t],E[t]=e.currentTargetLengths[t],e.randomDirections[t]?k[t]=new I(e.randomDirections[t].x,e.randomDirections[t].y,e.randomDirections[t].z):k[t]=null,w[t]=a-1e3,O[t]="growing";if(l&&e.cameraQuaternion){const t=new Ce(e.cameraQuaternion.x,e.cameraQuaternion.y,e.cameraQuaternion.z,e.cameraQuaternion.w);l.quaternion.set(0,0,0,1);const r=t.clone().invert();l.quaternion.premultiply(r),l.matrixWorldNeedsUpdate=!0,l.updateMatrixWorld(!0),l.matrixAutoUpdate=!1}console.log("模型設定已載入完成")}).catch(e=>{console.error("載入模型設定失敗:",e)})}function se(e){if(!(!y.value||!u))if(g==="growing"&&V!==null){const n=F.length;let a=0,t=0;for(let o=0;o<n;o++){if(w[o]===void 0||E[o]===void 0)continue;t++;const c=E[o]/((l==null?void 0:l.scale.x)||1),B=e-(w[o]||e),_=i.growth.speed*i.growth.flowSpeedFactor,T=c/(_/((l==null?void 0:l.scale.x)||1)),v=T>0?Math.min(B/T,1):1;a+=v}(t>0?a/t:0)>=.99&&(g="pauseAtEnd",console.log("所有線條已生長完成，進入暫停狀態"),setTimeout(()=>{y.value&&le()},1e3))}else g==="shrinking"&&p!==null&&S!==null&&e>=S&&(g="pauseAtStart",console.log("所有線條已收合完成，進入起始暫停狀態"),setTimeout(()=>{y.value&&ce()},1e3))}function le(){if(!u)return;const e=u.getElapsedTime();console.log("所有線條同步收合"),g="shrinking",p=e,S=e+i.timing.baseShrinkDuration*i.timing.flowShrinkDurationFactor,G=!0}function ce(){var a;if(!u)return;const e=u.getElapsedTime(),n=F.length;console.log("所有線條同步生長"),g="growing",V=e,G=!1,R=null,A.forEach(t=>{t.startTime=e,t.active=!0,t.mesh.position.set(0,0,0),t.direction.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize()});for(let t=0;t<n;t++){if(w[t]===void 0)continue;k[t]||(k[t]=new I),(a=k[t])==null||a.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize();const r=2,o=3.5;E[t]=$.randFloat(r,o),w[t]=e}}function ue(e){if(!u)return 0;if(e===void 0&&(e=u.getElapsedTime()),g==="shrinking"){if(p===null||S===null)return 0;const n=S-p,a=e-p,t=Math.min(a/n,1);return i.centerBall.minStrength+t*(i.centerBall.maxStrength-i.centerBall.minStrength)}else if(g==="pauseAtStart"){if(R===null)return R=e,i.centerBall.maxStrength;const n=e-R,a=Math.min(n/i.centerBall.fadeDuration,1);let t;switch(i.centerBall.fadeEasing.type){case"easeIn":t=Math.pow(a,i.centerBall.fadeEasing.power);break;case"easeOut":t=1-Math.pow(1-a,i.centerBall.fadeEasing.power);break;case"linear":default:t=a;break}return i.centerBall.maxStrength*(1-t)}else return i.centerBall.minStrength}function de(){he();const e=new ze(i.shootingSpheres.radius,i.shootingSpheres.geometry.segments,i.shootingSpheres.geometry.rings),n=new Y({...ne,envMap:s.environment});for(let a=0;a<i.shootingSpheres.count;a++){const t=new K(e,n);t.position.set(0,0,0),A.push({mesh:t,direction:me(),startTime:null,active:!1}),s.add(t)}}function me(){return new I(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize()}function he(){A.forEach(e=>{e.mesh&&(s.remove(e.mesh),e.mesh.geometry.dispose(),e.mesh.material.dispose())}),A=[]}function fe(e){!y.value||!u||A.forEach(n=>{if(!n.active)return;const a=ge(n,e);pe(n,a)})}function ge(e,n){const a=n-e.startTime;switch(g){case"growing":const t=Math.min(a/(i.shootingSpheres.maxDistance/i.shootingSpheres.speed),1);return Math.pow(t,i.growth.easeOutPower);case"shrinking":if(p!==null&&S!==null){const r=S-p,o=n-p;return 1-Math.min(o/r,1)}return 1;case"pauseAtEnd":return 1;case"pauseAtStart":default:return 0}}function pe(e,n){e.mesh.position.copy(e.direction.clone().multiplyScalar(i.shootingSpheres.maxDistance*n))}function J(){if(X=requestAnimationFrame(J),!l||!m||!h||!d||!s||!f)return;const e=u.getElapsedTime();re(l),fe(e),f.update(),W.value==="shader"&&!H.value&&(m.shader.uniforms.uTime.value=e,m.shader.uniforms.viewVector.value=h.position),H.value&&P?P.render():d.render(s,h)}function Z(){var a,t;if(!h||!d||!m)return;const e=((a=x.value)==null?void 0:a.clientWidth)??window.innerWidth,n=((t=x.value)==null?void 0:t.clientHeight)??window.innerHeight;h.aspect=e/n,h.updateProjectionMatrix(),d.setSize(e,n),P&&P.setSize(e,n),m.shader&&m.shader.uniforms.uResolution.value.set(e,n)}return Ie(()=>{if(!x.value){console.error("Canvas container not found!");return}const e=x.value,n=e.clientWidth,a=e.clientHeight;s=new Se,s.background=null,h=new Me(45,n/a,.1,1e3),h.position.set(0,0,25),h.lookAt(s.position),d=new ye({antialias:!0,alpha:!0}),d.setSize(n,a),d.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),e.appendChild(d.domElement),f=new xe(h,d.domElement),f.enableDamping=!0,f.autoRotate=te.value,f.autoRotateSpeed=5,f.enablePan=!1,f.enableZoom=!1,f.minPolarAngle=Math.PI/2,f.maxPolarAngle=Math.PI/2,f.minAzimuthAngle=-1/0,f.maxAzimuthAngle=1/0,s.add(new Pe(16777215,.3));const t=new ke(16777215,.5);t.position.set(5,10,7.5),s.add(t),D=new Ee(d),D.compileEquirectangularShader(),m=ae(),l=new Te(200,m[W.value],!0,!0,1e5),l.isolation=300,l.scale.set(8,8,8),l.enableUvs=!1,l.enableColors=!1,s.add(l),P=new Be(d),N=new _e(5,s,h),P.addPass(N);const r=new qe;if(P.addPass(r),u=new Re,ie(),de(),J(),y.value){console.log("初始化流動動畫狀態...");const o=u.getElapsedTime();h.position.clone(),h.quaternion.clone(),g="growing",V=o,A.forEach(c=>{c.startTime=o,c.active=!0,c.mesh.position.set(0,0,0),c.direction.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize()}),oe()}window.addEventListener("resize",Z)}),Oe(()=>{var e,n;cancelAnimationFrame(X),window.removeEventListener("resize",Z),f&&f.dispose(),d&&d.dispose(),m&&((e=m.shader)==null||e.dispose(),(n=m.liquid)==null||n.dispose(),s!=null&&s.environment&&s.environment.dispose()),l&&(s==null||s.remove(l)),s&&s.traverse(a=>{var t;if(a instanceof K){(t=a.geometry)==null||t.dispose();const r=a.material;Array.isArray(r)?r.forEach(o=>o.dispose()):r&&r.dispose()}}),D&&D.dispose(),x.value&&d&&x.value.removeChild(d.domElement),console.log("Three.js scene cleaned up.")}),(e,n)=>(Qe(),Ve(Ge,null,[n[0]||(n[0]=b("div",{class:"main-container"},[b("h1",{class:"company-name"},[b("div",{class:"front-name"}," Splash "),b("div",{class:"back-name"}," DigiLab ")])],-1)),b("div",Ue,[b("div",{ref_key:"canvasContainer",ref:x,class:"canvas-container"},null,512)])],64))}};export{Ye as default};
