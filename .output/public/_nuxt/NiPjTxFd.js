import{S as Le,P as ve,W as Me,O as xe,a as ke,M as Pe,E as Ce,f as Be,b as Ee,j as Fe,e as Te,g as W,h as I,i as ye}from"./GFrmpgK8.js";import{r as O,j as _e,T as K,o as be,I as Ae,t as De,x as j,y as Ge,K as ee,v as ze}from"./DzvUFI15.js";const Re={class:"splash-container"},We=["disabled"],Ue={__name:"ver2-3",setup(Ie){const E=O(null),ne=O(null),N=O(!1),z=O(!1),te=_e(()=>z.value?"返回":"播放"),c=K({startStrength:.1,endStrength:.01,minLength:2.5,maxLength:3.5,shrinkPower:.25,numLines:4}),u=K({startStrength:.01,endStrength:.1,minLength:2,maxLength:3,shrinkPower:1.25,numLines:3}),a=K({resolution:200,growthSpeed:5,growthEaseOutPower:.15,numSegments:50,subtract:20,flowGrowthSpeedFactor:.1,flowShrinkDurationFactor:.2,baseShrinkDuration:3,flowWaveFrequency:1,flowWaveAmplitudeFactor:.15,flowWavePhaseFactor:Math.PI*4,maxCenterBallStrength:0,minCenterBallStrength:0});let s=null,v=null,h=null,k=null,o=null,g=null,P=null,_=null,X=null,f=[],p=[],w=[],F=[],T=[],C=null,y=null,J=null,l="idle",S=0,Q=null,Y=null;function re(){return new Fe({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.5,thickness:1,envMapIntensity:100,side:Te})}function ae(){return new Promise((n,r)=>{new Ce().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=Be;const t=_.fromEquirectangular(e).texture;_.dispose(),e.dispose(),console.log("環境貼圖已載入"),s.environment=t,P&&(P.envMap=t,P.needsUpdate=!0),n(t)},void 0,e=>{console.error("無法載入環境貼圖:",e),r(e)})})}function ie(){var t,L;if(!g||!o)return;const n=g.getElapsedTime(),r=c.numLines+u.numLines;f.length=r,p.length=r,w.length=r,F.length=r,T.length=r;let e=0;for(let i=0;i<c.numLines;i++)p[e]||(p[e]=new W),(t=p[e])==null||t.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),w[e]=I.randFloat(c.minLength,c.maxLength),F[e]="tt",f[e]=n,l?T[e]=l:T[e]="growing",e++;for(let i=0;i<u.numLines;i++)p[e]||(p[e]=new W),(L=p[e])==null||L.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),w[e]=I.randFloat(u.minLength,u.maxLength),F[e]="th",f[e]=n,l?T[e]=l:T[e]="growing",e++;o.reset()}function oe(n){if(!g)return;n.reset();const r=g.getElapsedTime(),e=new W(.5,.5,.5),t=c.numLines+u.numLines;le(r);const L=ue(r);L>.01&&n.addBall(e.x,e.y,e.z,L,a.subtract);for(let i=0;i<t;i++){if(f[i]===void 0||r<f[i]||w[i]===void 0)continue;const d=w[i]/n.scale.x;let m=0,b=r-f[i];if(l==="pauseAtStart")m=.05;else if(l==="pauseAtEnd")m=d;else if(l==="growing")if(d>.001){const M=a.growthSpeed*a.flowGrowthSpeedFactor,x=d/(M/n.scale.x),D=x>0?Math.min(b/x,1):1;m=Math.pow(D,a.growthEaseOutPower)*d}else m=0;else if(l==="shrinking")if(C!==null&&y!==null){const M=y-C,x=r-C,D=Math.min(x/M,1),G=Math.max(0,1-D);m=d*G}else m=d;else if(d>.001){const M=Math.min(b/(d/(a.growthSpeed/n.scale.x)),1);m=Math.pow(M,a.growthEaseOutPower)*d}else m=0;if(m<=.001)continue;const B=p[i],A=F[i];if(!B||!A)continue;let q,H,U;A==="tt"?(q=c.startStrength,H=c.endStrength,U=c.shrinkPower):(q=u.startStrength,H=u.endStrength,U=u.shrinkPower);for(let M=0;M<=a.numSegments;M++){const x=M/a.numSegments,D=Math.pow(x,U),G=I.lerp(q,H,D);let R=G;const pe=a.flowWaveAmplitudeFactor*G,we=Math.sin(r*a.flowWaveFrequency-x*a.flowWavePhaseFactor)*pe;R+=we,R=Math.max(R,0);const V=B.clone().multiplyScalar(m*x).add(e);n.addBall(V.x,V.y,V.z,R,a.subtract)}}n.update()}function le(n){if(g)if(l==="growing"&&J!==null){const r=c.numLines+u.numLines;let e=0,t=0;for(let i=0;i<r;i++){if(f[i]===void 0||w[i]===void 0)continue;t++;const d=w[i]/((o==null?void 0:o.scale.x)||1),m=n-(f[i]||n),b=a.growthSpeed*a.flowGrowthSpeedFactor,B=d/(b/((o==null?void 0:o.scale.x)||1)),A=B>0?Math.min(m/B,1):1;e+=A}(t>0?e/t:0)>=.99&&(l="pauseAtEnd",S=a.minCenterBallStrength,console.log("所有線條已生長完成，暫停動畫"))}else l==="shrinking"&&C!==null&&y!==null&&n>=y&&(l="pauseAtStart",S=a.maxCenterBallStrength,console.log("所有線條已收合完成，進入起始暫停狀態"))}function se(){if(!g)return;const n=g.getElapsedTime();console.log("所有線條同步收合"),l="shrinking",C=n,y=n+a.baseShrinkDuration*a.flowShrinkDurationFactor,Y=n,a.maxCenterBallStrength}function ce(){var e;if(!g)return;const n=g.getElapsedTime(),r=c.numLines+u.numLines;console.log("所有線條同步生長"),l="growing",J=n,Q=n,a.minCenterBallStrength;for(let t=0;t<r;t++){if(f[t]===void 0)continue;p[t]||(p[t]=new W),(e=p[t])==null||e.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),F[t]=t<c.numLines?"tt":"th";const L=F[t]==="tt"?c.minLength:u.minLength,i=F[t]==="tt"?c.maxLength:u.maxLength;w[t]=I.randFloat(L,i),f[t]=n}}function ue(n){if(!g)return a.maxCenterBallStrength;if(n===void 0&&(n=g.getElapsedTime()),l==="shrinking"&&Y!==null&&C!==null&&y!==null){const r=y-C,e=n-C,t=Math.min(e/r,1);return S=a.minCenterBallStrength+t*(a.maxCenterBallStrength-a.minCenterBallStrength),S}else if(l==="growing"&&Q!==null){const r=c.numLines+u.numLines;let e=0,t=0;for(let i=0;i<r;i++){if(f[i]===void 0||w[i]===void 0)continue;t++;const d=w[i]/((o==null?void 0:o.scale.x)||1),m=n-(f[i]||n),b=a.growthSpeed*a.flowGrowthSpeedFactor,B=d/(b/((o==null?void 0:o.scale.x)||1)),A=B>0?Math.min(m/B,1):1;e+=A}const L=t>0?e/t:0;return S=a.maxCenterBallStrength*(1-L),S}else return l==="pauseAtStart"?(S=a.maxCenterBallStrength,S):l==="pauseAtEnd"?(S=a.minCenterBallStrength,S):a.maxCenterBallStrength}function Z(){X=requestAnimationFrame(Z),!(!o||!P||!v||!h||!s||!k)&&(oe(o),k.update(),h.render(s,v))}function $(){var e,t;if(!v||!h)return;const n=((e=E.value)==null?void 0:e.clientWidth)??window.innerWidth,r=((t=E.value)==null?void 0:t.clientHeight)??window.innerHeight;v.aspect=n/r,v.updateProjectionMatrix(),h.setSize(n,r)}function he(){if(!E.value)return console.error("Canvas container not found!"),!1;const n=E.value,r=n.clientWidth,e=n.clientHeight;s=new Le,s.background=null,v=new ve(45,r/e,.1,1e3),v.position.set(0,0,30),v.lookAt(s.position),h=new Me({antialias:!0,alpha:!0}),h.setSize(r,e),h.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),n.appendChild(h.domElement),k=new xe(v,h.domElement),k.enableDamping=!0,k.autoRotate=!0,k.autoRotateSpeed=2,_=new ke(h),_.compileEquirectangularShader(),P=re();const t=a.resolution*1.5;return o=new Pe(a.resolution,P,!0,!0,1e5),o.isolation=t,o.scale.set(8,8,8),o.enableUvs=!1,o.enableColors=!1,s.add(o),S=a.maxCenterBallStrength,g=new ye,!0}function me(){cancelAnimationFrame(X),window.removeEventListener("resize",$),k&&k.dispose(),h&&h.dispose(),P&&(P.dispose(),s!=null&&s.environment&&s.environment.dispose()),o&&(s==null||s.remove(o)),s&&s.traverse(n=>{var r;if(n instanceof Ee){(r=n.geometry)==null||r.dispose();const e=n.material;Array.isArray(e)?e.forEach(t=>t.dispose()):e&&e.dispose()}}),_&&_.dispose(),E.value&&h&&E.value.removeChild(h.domElement),console.log("Three.js場景已清理")}function de(){if(l==="growing"||l==="shrinking"){console.log("動畫進行中，請等待完成");return}z.value?(z.value=!1,console.log("返回按鈕被點擊，開始收合動畫"),fe()):(z.value=!0,console.log("播放按鈕被點擊，開始生長動畫"),ge())}function ge(){l="growing",ce()}function fe(){l="shrinking",se()}function Se(){l="pauseAtStart",S=a.maxCenterBallStrength,ie();const n=c.numLines+u.numLines;for(let r=0;r<n;r++)T[r]!==void 0&&(T[r]="pauseAtStart");console.log("初始化完成：線條收合狀態，中心球體最大")}return be(()=>{he()&&(Z(),ae().then(()=>{console.log("環境貼圖載入完成"),Se(),N.value=!0}).catch(n=>{console.error("環境貼圖載入失敗:",n)}),window.addEventListener("resize",$))}),Ae(()=>{me()}),(n,r)=>(ze(),De("div",Re,[j("div",{ref_key:"canvasContainer",ref:E,class:"canvas-container"},null,512),j("button",{ref_key:"controlButton",ref:ne,class:"control-button",disabled:!ee(N),onClick:de},Ge(ee(te)),9,We)]))}};export{Ue as default};
