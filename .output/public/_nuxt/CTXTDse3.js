import{S as Ce,P as Ge,W as Re,O as ze,a as be,M as We,E as Ie,f as Oe,b as ce,j as ue,e as he,g as Q,h as X,k as qe,i as Be}from"./Cx5nvXSb.js";import{_ as me,r as V,Q as Z,o as He,I as de,t as ge,v as fe,x as y,z as Ue,y as te,K as ne,O as Ve}from"./DcyKddeJ.js";const Ne={class:"splash-container"},$e={__name:"Splash2",emits:["stateChange","animationComplete","resourcesLoaded"],setup(pe,{expose:G,emit:J}){const R=J,f=V(null),S=V(!1),l=Z({startStrength:.1,endStrength:.01,minLength:2.5,maxLength:3.5,shrinkPower:.25,numLines:4}),h=Z({startStrength:.01,endStrength:.1,minLength:2,maxLength:3,shrinkPower:1.25,numLines:3}),w=Z({count:20,minRadius:.2,maxRadius:.55,minLength:3,maxLength:12,segmentDetail:16,minScale:0}),s=Z({resolution:200,growthSpeed:5,growthEaseOutPower:.15,numSegments:50,subtract:20,flowGrowthSpeedFactor:.1,flowWaveAmplitudeFactorAtStart:1,flowShrinkDurationFactor:.2,baseShrinkDuration:2.5,flowWaveFrequency:1,flowWaveAmplitudeFactor:.15,flowWavePhaseFactor:Math.PI*4});let c=null,M=null,d=null,p=null,r=null,g=null,D=null,I=null,ie=null,v=[],k=[],_=[],z=[],T=[],b=[],O=null,x=null,W=null,q=null,m="idle";function Se(){return new ue({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.5,thickness:1,envMapIntensity:200,side:he})}function oe(){return new ue({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.2,transmission:1,ior:1.5,thickness:1,envMapIntensity:200,side:he})}function we(){return new Promise((n,i)=>{new Ie().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",t=>{t.mapping=Oe;const e=I.fromEquirectangular(t).texture;I.dispose(),t.dispose(),console.log("環境貼圖已載入"),c.environment=e,D&&(D.envMap=e,D.needsUpdate=!0),n(e)},void 0,t=>{console.error("無法載入環境貼圖:",t),i(t)})})}function ve(){var e,o;if(!g||!r)return;const n=g.getElapsedTime(),i=l.numLines+h.numLines;v.length=i,k.length=i,_.length=i,z.length=i,T.length=i;let t=0;for(let a=0;a<l.numLines;a++)k[t]||(k[t]=new Q),(e=k[t])==null||e.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),_[t]=X.randFloat(l.minLength,l.maxLength),z[t]="tt",v[t]=n,m?T[t]=m:T[t]="growing",t++;for(let a=0;a<h.numLines;a++)k[t]||(k[t]=new Q),(o=k[t])==null||o.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),_[t]=X.randFloat(h.minLength,h.maxLength),z[t]="th",v[t]=n,m?T[t]=m:T[t]="growing",t++;r.reset()}function Le(n){if(!g)return;n.reset();const i=g.getElapsedTime(),t=new Q(.5,.5,.5),e=l.numLines+h.numLines;Pe(i);for(let o=0;o<e;o++){if(v[o]===void 0||i<v[o]||_[o]===void 0)continue;const a=_[o]/n.scale.x;let u=0,L=i-v[o];if(m==="pauseAtStart")u=.05;else if(m==="pauseAtEnd")u=a;else if(m==="growing")if(a>.001){const F=s.growthSpeed*s.flowGrowthSpeedFactor,E=a/(F/n.scale.x),K=E>0?Math.min(L/E,1):1;u=Math.pow(K,s.growthEaseOutPower)*a}else u=0;else if(m==="shrinking")if(x!==null&&W!==null){const F=W-x,E=i-x,K=Math.min(E/F,1),B=Math.max(0,1-K),H=s.growthSpeed*s.flowGrowthSpeedFactor,U=a/(H/n.scale.x),ee=U>0?Math.min(L/U,1):1;u=Math.pow(ee,s.growthEaseOutPower)*a*B}else u=a;else if(a>.001){const F=Math.min(L/(a/(s.growthSpeed/n.scale.x)),1);u=Math.pow(F,s.growthEaseOutPower)*a}else u=0;if(u<=.001)continue;const A=k[o],P=z[o];if(!A||!P)continue;let C,$,j;P==="tt"?(C=l.startStrength,$=l.endStrength,j=l.shrinkPower):(C=h.startStrength,$=h.endStrength,j=h.shrinkPower);for(let F=0;F<=s.numSegments;F++){const E=F/s.numSegments,K=Math.pow(E,j),B=X.lerp(C,$,K);let H=B,U;m==="pauseAtStart"?U=s.flowWaveAmplitudeFactorAtStart*B:U=s.flowWaveAmplitudeFactor*B;const ee=Math.sin(i*s.flowWaveFrequency-E*s.flowWavePhaseFactor)*U;H+=ee,H=Math.max(H,0);const Y=A.clone().multiplyScalar(u*E).add(t);n.addBall(Y.x,Y.y,Y.z,H,s.subtract)}}n.update()}function Pe(n){if(g)if(m==="growing"&&q!==null){const i=l.numLines+h.numLines;let t=0,e=0;for(let a=0;a<i;a++){if(v[a]===void 0||_[a]===void 0)continue;e++;const u=_[a]/((r==null?void 0:r.scale.x)||1),L=n-(v[a]||n),A=s.growthSpeed*s.flowGrowthSpeedFactor,P=u/(A/((r==null?void 0:r.scale.x)||1)),C=P>0?Math.min(L/P,1):1;t+=C}(e>0?t/e:0)>=.99&&N("pauseAtEnd")}else m==="shrinking"&&x!==null&&W!==null&&n>=W&&N("pauseAtStart")}function Me(n,i){const t=new qe(i,w.segmentDetail,w.segmentDetail);O||(O=oe());const e=new ce(t,O);e.position.set(0,0,0);const o={mesh:e,direction:n,targetLength:0,initialScale:i,active:!0,progress:0,currentPosition:0,lastUpdateTime:g?g.getElapsedTime():0,transitionStartTime:null,transitionStartPos:0};return c.add(e),b.push(o),o}function ae(){se();for(let n=0;n<w.count;n++){const i=new Q(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),t=w.minRadius+Math.random()*(w.maxRadius-w.minRadius),e=Me(i,t);e.targetLength=X.randFloat(w.minLength,w.maxLength)}}function se(){for(let n=0;n<b.length;n++){const i=b[n];i.mesh&&(c.remove(i.mesh),i.mesh.geometry.dispose())}b=[]}function ke(){if(!g)return;const n=g.getElapsedTime();let i=1;if(m==="growing"&&q!==null){const t=l.numLines+h.numLines;let e=0,o=0;for(let a=0;a<t;a++){if(v[a]===void 0||_[a]===void 0)continue;o++;const u=_[a]/((r==null?void 0:r.scale.x)||1),L=n-(v[a]||n),A=s.growthSpeed*s.flowGrowthSpeedFactor,P=u/(A/((r==null?void 0:r.scale.x)||1)),C=P>0?Math.min(L/P,1):1;e+=C}i=o>0?e/o:1}for(let t=0;t<b.length;t++){const e=b[t];if(!e.active||!e.mesh)continue;let o=0;if(m==="pauseAtStart")o=0;else if(m==="pauseAtEnd")o=e.targetLength;else if(m==="growing"){if(q!==null){e.transitionStartTime!==q&&(e.transitionStartTime=q,e.transitionStartPos=e.currentPosition);const L=Math.pow(i,s.growthEaseOutPower),P=(e.targetLength-e.transitionStartPos)*L;o=e.transitionStartPos+P,i>=.99&&(o=e.targetLength)}}else if(m==="shrinking"&&x!==null&&W!==null){e.transitionStartTime!==x&&(e.transitionStartTime=x,e.transitionStartPos=e.currentPosition);const L=W-x,A=n-x,P=Math.min(A/L,1),$=e.transitionStartPos*P;o=e.transitionStartPos-$,P>=.99&&(o=0)}o=Math.max(0,Math.min(o,e.targetLength)),e.currentPosition=o,e.progress=e.targetLength>0?o/e.targetLength:0;const a=e.direction.clone().multiplyScalar(o);e.mesh.position.copy(a);let u;if(o<.01)u=w.minScale;else{const L=Math.min(e.progress*1.5,1);u=w.minScale+(e.initialScale-w.minScale)*L}e.mesh.scale.set(u,u,u)}}function re(){ie=requestAnimationFrame(re),!(!r||!D||!M||!d||!c||!p)&&(Le(r),ke(),p.update(),d.render(c,M))}function le(){var t,e;if(!M||!d)return;const n=((t=f.value)==null?void 0:t.clientWidth)??window.innerWidth,i=((e=f.value)==null?void 0:e.clientHeight)??window.innerHeight;M.aspect=n/i,M.updateProjectionMatrix(),d.setSize(n,i)}function _e(){if(!f.value)return console.error("Canvas container not found!"),!1;const n=f.value,i=n.clientWidth,t=n.clientHeight;c=new Ce,c.background=null,M=new Ge(45,i/t,.1,1e3),M.position.set(0,0,30),M.lookAt(c.position),d=new Re({antialias:!0,alpha:!0}),d.setSize(i,t),d.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),n.appendChild(d.domElement),p=new ze(M,d.domElement),p.enableDamping=!0,p.autoRotate=!0,p.autoRotateSpeed=2,I=new be(d),I.compileEquirectangularShader(),D=Se();const e=s.resolution*1.5;return r=new We(s.resolution,D,!0,!0,1e5),r.isolation=e,r.scale.set(8,8,8),r.enableUvs=!1,r.enableColors=!1,c.add(r),g=new Be,O=oe(),!0}function xe(){cancelAnimationFrame(ie),window.removeEventListener("resize",le),se(),p&&p.dispose(),d&&d.dispose(),D&&(D.dispose(),c!=null&&c.environment&&c.environment.dispose()),r&&(c==null||c.remove(r)),c&&c.traverse(n=>{var i;if(n instanceof ce){(i=n.geometry)==null||i.dispose();const t=n.material;Array.isArray(t)?t.forEach(e=>e.dispose()):t&&t.dispose()}}),I&&I.dispose(),f.value&&d&&f.value.removeChild(d.domElement),O&&O.dispose(),console.log("Three.js場景已清理")}function Te(){S.value==!1&&(S.value=!0,m="growing",Ee())}function Ae(){S.value==!0&&(S.value=!1,m="shrinking",ye())}function Fe(){N("pauseAtStart"),ve(),ae();const n=l.numLines+h.numLines;for(let i=0;i<n;i++)T[i]!==void 0&&(T[i]="pauseAtStart");console.log("初始化完成：線條收合狀態")}function N(n){m=n,R("stateChange",n),n==="pauseAtEnd"?(console.log("所有線條已生長完成，暫停動畫"),R("animationComplete","growing")):n==="pauseAtStart"&&(console.log("所有線條已收合完成，進入起始暫停狀態"),R("animationComplete","shrinking"))}function Ee(){var t;if(!g)return;const n=g.getElapsedTime(),i=l.numLines+h.numLines;console.log("所有線條同步生長"),b.length===0&&ae(),N("growing"),q=n;for(let e=0;e<i;e++){if(v[e]===void 0)continue;k[e]||(k[e]=new Q),(t=k[e])==null||t.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),z[e]=e<l.numLines?"tt":"th";const o=z[e]==="tt"?l.minLength:h.minLength,a=z[e]==="tt"?l.maxLength:h.maxLength;_[e]=X.randFloat(o,a),v[e]=n,T[e]="growing"}}function ye(){if(!g)return;const n=g.getElapsedTime();console.log("所有線條同步收合"),N("shrinking"),x=n,W=n+s.baseShrinkDuration*s.flowShrinkDurationFactor;const i=l.numLines+h.numLines;for(let t=0;t<i;t++)v[t]!==void 0&&(T[t]="shrinking")}return He(()=>{_e()&&(re(),we().then(()=>{console.log("環境貼圖載入完成"),Fe(),S.value=!1,R("resourcesLoaded",!0)}).catch(n=>{console.error("環境貼圖載入失敗:",n)}),window.addEventListener("resize",le))}),de(()=>{xe()}),G({startGrowingAnimation:Te,startShrinkingAnimation:Ae}),(n,i)=>(fe(),ge("div",Ne,[y("div",{ref_key:"canvasContainer",ref:f,class:"canvas-container"},null,512)]))}},Ke=me($e,[["__scopeId","data-v-02494331"]]),Qe={class:"button-group"},Xe={class:"status"},Je={class:"status"},Ye={class:"status"},Ze={__name:"ver2-6",setup(pe){const G=V(null),J=V(!1),R=V("idle"),f=V(!1);let S=null;const l=()=>{G.value&&G.value.startGrowingAnimation()},h=()=>{G.value&&G.value.startShrinkingAnimation()},w=()=>{J.value=!0,console.log("資源載入完成，開始自動播放"),M()},s=p=>{R.value=p},c=p=>{f.value&&(p==="growing"?S=setTimeout(()=>{h()},1e3):p==="shrinking"&&(S=setTimeout(()=>{l()},1e3)))},M=()=>{f.value||(f.value=!0,l())},d=()=>{f.value=!1,S&&(clearTimeout(S),S=null),h()};return de(()=>{S&&clearTimeout(S),f.value=!1}),(p,r)=>{const g=Ke;return fe(),ge(Ve,null,[Ue(g,{ref_key:"splashRef",ref:G,onResourcesLoaded:w,onStateChange:s,onAnimationComplete:c},null,512),y("div",Qe,[y("button",{onClick:l},"開始生長"),y("button",{onClick:h},"開始收合"),y("button",{onClick:M},"開始自動播放"),y("button",{onClick:d},"停止自動播放"),y("div",Xe,"狀態: "+te(ne(R)),1),y("div",Je,"資源狀態: "+te(ne(J)?"已載入":"載入中"),1),y("div",Ye,"自動播放: "+te(ne(f)?"進行中":"停止"),1)])],64)}}},tt=me(Ze,[["__scopeId","data-v-81e9fa62"]]);export{tt as default};
