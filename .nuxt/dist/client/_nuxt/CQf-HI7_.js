import{S as E,P,W as T,O as G,a as I,M as C,E as A,f as z,b as D,j as F,e as H,g as M,h as y}from"./GFrmpgK8.js";import{r as W,o as B,I as q,t as O,v as U}from"./iXxArwze.js";const J={__name:"generate-1",setup(N){const r={scene:{scale:8,pixelRatio:1.5},metaball:{resolution:200,segments:50,subtract:20,maxBalls:1e5},material:{color:16777215,metalness:0,roughness:0,opacity:.75,transmission:1,ior:1.33,thickness:1,envMapIntensity:300},lines:{thickToThin:{startStrength:.1,endStrength:.01,minLength:2.5,maxLength:3.5,shrinkPower:.25,count:4},thinToThick:{startStrength:.01,endStrength:.1,minLength:2,maxLength:3,shrinkPower:1.25,count:3}},controls:{autoRotate:!0,rotateSpeed:2,enableDamping:!0}},c=W(null),e={scene:null,camera:null,renderer:null,controls:null,effect:null,material:null,pmremGenerator:null,animationId:null,lines:{directions:[],lengths:[],types:[]},dispose(){var n,i;cancelAnimationFrame(this.animationId),this.controls&&this.controls.dispose(),this.renderer&&this.renderer.dispose(),this.material&&(this.material.dispose(),(n=this.scene)!=null&&n.environment&&this.scene.environment.dispose()),this.effect&&((i=this.scene)==null||i.remove(this.effect)),this.scene&&this.scene.traverse(t=>{var a;t instanceof D&&((a=t.geometry)==null||a.dispose(),Array.isArray(t.material)?t.material.forEach(o=>o.dispose()):t.material&&t.material.dispose())}),this.pmremGenerator&&this.pmremGenerator.dispose(),c.value&&this.renderer&&c.value.removeChild(this.renderer.domElement)}};function S(){return new F({color:r.material.color,metalness:r.material.metalness,roughness:r.material.roughness,transparent:!0,opacity:r.material.opacity,side:H,transmission:r.material.transmission,ior:r.material.ior,thickness:r.material.thickness,envMapIntensity:r.material.envMapIntensity})}function k(){return new Promise((n,i)=>{new A().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",t=>{t.mapping=z;const a=e.pmremGenerator.fromEquirectangular(t).texture;e.pmremGenerator.dispose(),t.dispose(),e.scene.environment=a,e.material&&(e.material.envMap=a,e.material.needsUpdate=!0),n(a)},void 0,t=>{console.error("無法載入環境貼圖:",t),i(t)})})}function x(){const{thickToThin:n,thinToThick:i}=r.lines,t=n.count+i.count;e.lines.directions=new Array(t),e.lines.lengths=new Array(t),e.lines.types=new Array(t);let a=0;const o=(s,l)=>{const d=new M(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),m=y.randFloat(s.minLength,s.maxLength);e.lines.directions[a]=d,e.lines.lengths[a]=m,e.lines.types[a]=l,a++};for(let s=0;s<n.count;s++)o(n,"tt");for(let s=0;s<i.count;s++)o(i,"th");e.effect&&b()}function b(){const n=e.effect;if(!n)return;n.reset();const i=new M(.5,.5,.5),{directions:t,lengths:a,types:o}=e.lines,s=o.length;for(let l=0;l<s;l++){if(!a[l])continue;const d=a[l]/n.scale.x,m=t[l],w=o[l];if(!m||!w)continue;const h=w==="tt"?r.lines.thickToThin:r.lines.thinToThick;for(let u=0;u<=r.metaball.segments;u++){const v=u/r.metaball.segments,R=Math.pow(v,h.shrinkPower),_=y.lerp(h.startStrength,h.endStrength,R),f=m.clone().multiplyScalar(d*v).add(i);n.addBall(f.x,f.y,f.z,_,r.metaball.subtract)}}n.update()}function p(){var t,a;if(!e.camera||!e.renderer)return;const n=((t=c.value)==null?void 0:t.clientWidth)??window.innerWidth,i=((a=c.value)==null?void 0:a.clientHeight)??window.innerHeight;e.camera.aspect=n/i,e.camera.updateProjectionMatrix(),e.renderer.setSize(n,i)}function L(){if(!c.value)return console.error("找不到畫布容器!"),!1;const n=c.value,i=n.clientWidth||window.innerWidth,t=n.clientHeight||window.innerHeight;e.scene=new E,e.scene.background=null,e.camera=new P(45,i/t,.1,1e3),e.camera.position.set(0,0,30),e.camera.lookAt(0,0,0),e.renderer=new T({antialias:!0,alpha:!0}),e.renderer.setSize(i,t),e.renderer.setPixelRatio(Math.min(window.devicePixelRatio,r.scene.pixelRatio)),n.appendChild(e.renderer.domElement),e.controls=new G(e.camera,e.renderer.domElement),e.controls.enableDamping=r.controls.enableDamping,e.controls.autoRotate=r.controls.autoRotate,e.controls.autoRotateSpeed=r.controls.rotateSpeed,e.pmremGenerator=new I(e.renderer),e.pmremGenerator.compileEquirectangularShader(),e.material=S();const a=r.metaball.resolution*1.5;return e.effect=new C(r.metaball.resolution,e.material,!0,!0,r.metaball.maxBalls),e.effect.isolation=a,e.effect.scale.set(r.scene.scale,r.scene.scale,r.scene.scale),e.effect.enableUvs=!1,e.effect.enableColors=!1,e.scene.add(e.effect),!0}function g(){const{camera:n,renderer:i,scene:t,controls:a,effect:o}=e;!o||!n||!i||!t||!a||(a.update(),i.render(t,n),e.animationId=requestAnimationFrame(g))}return B(async()=>{if(L())try{await k(),x(),g(),window.addEventListener("resize",p)}catch(n){console.error("初始化失敗:",n)}}),q(()=>{e.dispose(),window.removeEventListener("resize",p)}),(n,i)=>(U(),O("div",{ref_key:"canvasContainer",ref:c,class:"splash-container"},null,512))}};export{J as default};
