import{S as ue,P as he,W as me,O as de,a as ge,M as fe,E as Se,f as we,b as pe,j as Le,e as ve,g as R,h as W,i as Me}from"./GFrmpgK8.js";import{r as $,S as V,o as xe,I as ke,t as Pe,x as Ee,v as Ce}from"./B_MDMm1d.js";const Fe={class:"splash-container"},_e={__name:"ver2-2",setup(Be){const F=$(null),c=V({startStrength:.1,endStrength:.01,minLength:2.5,maxLength:3.5,shrinkPower:.25,numLines:4}),h=V({startStrength:.01,endStrength:.1,minLength:2,maxLength:3,shrinkPower:1.25,numLines:3}),r=V({resolution:200,growthSpeed:5,growthEaseOutPower:.15,numSegments:50,subtract:20,flowGrowthSpeedFactor:.1,flowShrinkDurationFactor:.2,baseShrinkDuration:3,flowWaveFrequency:1,flowWaveAmplitudeFactor:.15,flowWavePhaseFactor:Math.PI*4,maxCenterBallStrength:1,minCenterBallStrength:0}),I=$(!0);let l=null,v=null,u=null,k=null,o=null,d=null,P=null,b=null,N=null,g=[],w=[],p=[],B=[],A=[],E=null,T=null,X=null,f="idle",S=0,J=null,K=null;function j(){return new Le({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.5,thickness:1,envMapIntensity:100,side:ve})}function ee(){return new Promise((n,a)=>{new Se().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=we;const t=b.fromEquirectangular(e).texture;b.dispose(),e.dispose(),console.log("環境貼圖已載入"),l.environment=t,P&&(P.envMap=t,P.needsUpdate=!0),n(t)},void 0,e=>{console.error("無法載入環境貼圖:",e),a(e)})})}function ne(){var t,L;if(!d||!o)return;const n=d.getElapsedTime(),a=c.numLines+h.numLines;g.length=a,w.length=a,p.length=a,B.length=a,A.length=a;let e=0;for(let i=0;i<c.numLines;i++)w[e]||(w[e]=new R),(t=w[e])==null||t.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),p[e]=W.randFloat(c.minLength,c.maxLength),B[e]="tt",g[e]=n,A[e]="growing",e++;for(let i=0;i<h.numLines;i++)w[e]||(w[e]=new R),(L=w[e])==null||L.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),p[e]=W.randFloat(h.minLength,h.maxLength),B[e]="th",g[e]=n,A[e]="growing",e++;o.reset()}function te(n){if(!d)return;n.reset();const a=d.getElapsedTime(),e=new R(.5,.5,.5),t=c.numLines+h.numLines;re(a);const L=ie(a);L>.01&&n.addBall(e.x,e.y,e.z,L,r.subtract);for(let i=0;i<t;i++){if(g[i]===void 0||a<g[i]||p[i]===void 0)continue;const m=p[i]/n.scale.x;let s=0,y=a-g[i];if(I.value){switch(f){case"growing":if(m>.001){const M=r.growthSpeed*r.flowGrowthSpeedFactor,x=m/(M/n.scale.x),D=x>0?Math.min(y/x,1):1;s=Math.pow(D,r.growthEaseOutPower)*m}else s=0;break;case"pauseAtEnd":s=m;break;case"shrinking":if(E!==null&&T!==null){const M=T-E,x=a-E,D=Math.min(x/M,1),G=Math.max(0,1-D);s=m*G}else s=m;break;case"pauseAtStart":s=.001;break;default:s=0;break}A[i]=f}else if(m>.001){const M=Math.min(y/(m/(r.growthSpeed/n.scale.x)),1);s=Math.pow(M,r.growthEaseOutPower)*m}else s=0;if(s<=.001)continue;const C=w[i],_=B[i];if(!C||!_)continue;let O,q,H;_==="tt"?(O=c.startStrength,q=c.endStrength,H=c.shrinkPower):(O=h.startStrength,q=h.endStrength,H=h.shrinkPower);for(let M=0;M<=r.numSegments;M++){const x=M/r.numSegments,D=Math.pow(x,H),G=W.lerp(O,q,D);let z=G;if(I.value){const se=r.flowWaveAmplitudeFactor*G,ce=Math.sin(a*r.flowWaveFrequency-x*r.flowWavePhaseFactor)*se;z+=ce,z=Math.max(z,0)}const U=C.clone().multiplyScalar(s*x).add(e);n.addBall(U.x,U.y,U.z,z,r.subtract)}}n.update()}function re(n){if(!(!I.value||!d))if(f==="growing"&&X!==null){const a=c.numLines+h.numLines;let e=0,t=0;for(let i=0;i<a;i++){if(g[i]===void 0||p[i]===void 0)continue;t++;const m=p[i]/((o==null?void 0:o.scale.x)||1),s=n-(g[i]||n),y=r.growthSpeed*r.flowGrowthSpeedFactor,C=m/(y/((o==null?void 0:o.scale.x)||1)),_=C>0?Math.min(s/C,1):1;e+=_}(t>0?e/t:0)>=.99&&(f="pauseAtEnd",S=r.minCenterBallStrength,console.log("所有線條已生長完成，進入暫停狀態"),ae())}else f==="shrinking"&&E!==null&&T!==null&&n>=T&&(f="pauseAtStart",S=r.maxCenterBallStrength,console.log("所有線條已收合完成，進入起始暫停狀態"),Q())}function ae(){if(!d)return;const n=d.getElapsedTime();console.log("所有線條同步收合"),f="shrinking",E=n,T=n+r.baseShrinkDuration*r.flowShrinkDurationFactor,K=n,r.maxCenterBallStrength}function Q(){var e;if(!d)return;const n=d.getElapsedTime(),a=c.numLines+h.numLines;console.log("所有線條同步生長"),f="growing",X=n,J=n,r.minCenterBallStrength;for(let t=0;t<a;t++){if(g[t]===void 0)continue;w[t]||(w[t]=new R),(e=w[t])==null||e.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),B[t]=t<c.numLines?"tt":"th";const L=B[t]==="tt"?c.minLength:h.minLength,i=B[t]==="tt"?c.maxLength:h.maxLength;p[t]=W.randFloat(L,i),g[t]=n}}function ie(n){if(!d)return r.minCenterBallStrength;if(n===void 0&&(n=d.getElapsedTime()),f==="shrinking"&&K!==null&&E!==null&&T!==null){const a=T-E,e=n-E,t=Math.min(e/a,1);return S=r.minCenterBallStrength+t*(r.maxCenterBallStrength-r.minCenterBallStrength),S}else if(f==="growing"&&J!==null){const a=c.numLines+h.numLines;let e=0,t=0;for(let i=0;i<a;i++){if(g[i]===void 0||p[i]===void 0)continue;t++;const m=p[i]/((o==null?void 0:o.scale.x)||1),s=n-(g[i]||n),y=r.growthSpeed*r.flowGrowthSpeedFactor,C=m/(y/((o==null?void 0:o.scale.x)||1)),_=C>0?Math.min(s/C,1):1;e+=_}const L=t>0?e/t:0;return S=r.maxCenterBallStrength*(1-L),S}else return f==="pauseAtStart"?(S=r.maxCenterBallStrength,S):(f==="pauseAtEnd"&&(S=r.minCenterBallStrength),S)}function Y(){N=requestAnimationFrame(Y),!(!o||!P||!v||!u||!l||!k)&&(te(o),k.update(),u.render(l,v))}function Z(){var e,t;if(!v||!u)return;const n=((e=F.value)==null?void 0:e.clientWidth)??window.innerWidth,a=((t=F.value)==null?void 0:t.clientHeight)??window.innerHeight;v.aspect=n/a,v.updateProjectionMatrix(),u.setSize(n,a)}function oe(){if(!F.value)return console.error("Canvas container not found!"),!1;const n=F.value,a=n.clientWidth,e=n.clientHeight;l=new ue,l.background=null,v=new he(45,a/e,.1,1e3),v.position.set(0,0,30),v.lookAt(l.position),u=new me({antialias:!0,alpha:!0}),u.setSize(a,e),u.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),n.appendChild(u.domElement),k=new de(v,u.domElement),k.enableDamping=!0,k.autoRotate=!0,k.autoRotateSpeed=2,b=new ge(u),b.compileEquirectangularShader(),P=j();const t=r.resolution*1.5;return o=new fe(r.resolution,P,!0,!0,1e5),o.isolation=t,o.scale.set(8,8,8),o.enableUvs=!1,o.enableColors=!1,l.add(o),S=r.maxCenterBallStrength,d=new Me,!0}function le(){cancelAnimationFrame(N),window.removeEventListener("resize",Z),k&&k.dispose(),u&&u.dispose(),P&&(P.dispose(),l!=null&&l.environment&&l.environment.dispose()),o&&(l==null||l.remove(o)),l&&l.traverse(n=>{var a;if(n instanceof pe){(a=n.geometry)==null||a.dispose();const e=n.material;Array.isArray(e)?e.forEach(t=>t.dispose()):e&&e.dispose()}}),b&&b.dispose(),F.value&&u&&F.value.removeChild(u.domElement),console.log("Three.js場景已清理")}return xe(()=>{oe()&&(ee().then(()=>{console.log("環境貼圖載入完成")}).catch(n=>{console.error("環境貼圖載入失敗:",n)}),ne(),setTimeout(()=>{Q()},500),Y(),window.addEventListener("resize",Z))}),ke(()=>{le()}),(n,a)=>(Ce(),Pe("div",Fe,[Ee("div",{ref_key:"canvasContainer",ref:F,class:"canvas-container"},null,512)]))}};export{_e as default};
