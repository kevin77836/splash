import{a as ve,j as K,d as we,e as Y,M as Se,b as $,S as xe,P as ye,W as Me,O as Pe,A as ke,D as Ee,C as Te,V as Ae,E as be,f as De,k as ze,g as O,Q as Ce,h as j,i as Re}from"./Cx5nvXSb.js";import{E as Fe,R as Be,O as Le}from"./DpJLAcoC.js";import{r as _,o as _e,I as qe,t as Ie,x as C,O as Oe,v as Ve}from"./DcyKddeJ.js";const Qe={class:"splash-container"},ee=50,te=20,Ue=`
  uniform vec3 viewVector;
  uniform vec2 uResolution;
  uniform float uTime;
  varying vec2 vUv;
  varying float opacity;
  void main() {
    vUv = uv;
    vec4 mvPos = modelViewMatrix * vec4(position, 1.0);
    gl_Position = projectionMatrix * mvPos;
    vec3 nNormal = normalize(normalMatrix * normal);
    vec3 nView   = normalize(viewVector - mvPos.xyz);
    opacity = dot(nNormal, nView);
    opacity = 1.0 - abs(opacity * 1.3);
  }
`,Ge=`
  uniform vec3 uColor;
  uniform vec2 uResolution;
  uniform float uTime;
  varying vec2 vUv;
  varying float opacity;
  void main() {
    vec2 d = gl_FragCoord.xy / uResolution;
    vec3 fade = vec3(d.x, d.y, 1.0);
    vec3 c = mix(vec3(0.0), fade * uColor, opacity);
    gl_FragColor = vec4(c, 1.0);
  }
`,Je={__name:"ver5",setup(We){const b=_(null),W=_("liquid"),H=_(!1),ne=_(!0),M=_(!0);let h,f,P,R,l,c,m,F,E,N,X,D=[],x=[],T=[],A=[],z=[],V=[],g=null,y=null,Q=null,U=!1,p="idle",q=null;const a={centerBall:{maxStrength:1,minStrength:0,fadeDuration:5,fadeEasing:{type:"easeIn",power:.5}},shootingSpheres:{count:12,size:{min:.1,max:.2},speed:{base:3,variation:.5},distance:{min:6,max:10},geometry:{segments:16,rings:16},spawnArea:{radius:.5}},timing:{baseShrinkDuration:3,flowShrinkDurationFactor:.2},growth:{speed:5,easeOutPower:.15,flowSpeedFactor:.1},wave:{frequency:1,amplitudeFactor:.3,phaseFactor:Math.PI*4},renderer:{pixelRatio:1.5,antialias:!0,alpha:!0},camera:{fov:45,near:.1,far:1e3,position:{x:0,y:0,z:25}},controls:{enableDamping:!0,autoRotateSpeed:5,enablePan:!1,enableZoom:!1,polarAngle:Math.PI/2}};function ae(){new be().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=De;const n=F.fromEquirectangular(e).texture;F.dispose(),e.dispose(),console.log("本地 EXR 環境貼圖已載入並處理完成。"),h.environment=n,m&&m.liquid&&(m.liquid.envMap=n,m.liquid.needsUpdate=!0)},void 0,e=>{console.error("無法載入本地 EXR 環境貼圖:",e)})}function oe(){fetch("/modelJson.json").then(e=>e.json()).then(e=>{console.log("讀取的設定:",e);const n=e.lineTypes.length;x=new Array(n),T=new Array(n),A=new Array(n),z=new Array(n),V=new Array(n);const o=(c==null?void 0:c.getElapsedTime())??0;for(let t=0;t<n;t++)z[t]=e.lineTypes[t],A[t]=e.currentTargetLengths[t],e.randomDirections[t]?T[t]=new O(e.randomDirections[t].x,e.randomDirections[t].y,e.randomDirections[t].z):T[t]=null,x[t]=o-1e3,V[t]="growing";if(l&&e.cameraQuaternion){const t=new Ce(e.cameraQuaternion.x,e.cameraQuaternion.y,e.cameraQuaternion.z,e.cameraQuaternion.w);l.quaternion.set(0,0,0,1);const r=t.clone().invert();l.quaternion.premultiply(r),l.matrixWorldNeedsUpdate=!0,l.updateMatrixWorld(!0),l.matrixAutoUpdate=!1}console.log("模型設定已載入完成")}).catch(e=>{console.error("載入模型設定失敗:",e)})}function ie(e){if(!(!M.value||!c))if(p==="growing"&&Q!==null){const n=z.length;let o=0,t=0;for(let i=0;i<n;i++){if(x[i]===void 0||A[i]===void 0)continue;t++;const s=A[i]/((l==null?void 0:l.scale.x)||1),w=e-(x[i]||e),k=a.growth.speed*a.growth.flowSpeedFactor,S=s/(k/((l==null?void 0:l.scale.x)||1)),u=S>0?Math.min(w/S,1):1;o+=u}(t>0?o/t:0)>=.99&&(p="pauseAtEnd",console.log("所有線條已生長完成，進入暫停狀態"),setTimeout(()=>{M.value&&le()},1e3))}else p==="shrinking"&&g!==null&&y!==null&&e>=y&&(p="pauseAtStart",console.log("所有線條已收合完成，進入起始暫停狀態"),setTimeout(()=>{M.value&&se()},1e3))}function re(e){if(!c)return;e.reset();const n=c.getElapsedTime(),o=new O(.5,.5,.5),t=z.length;if(M.value&&ie(n),U){const r=ce(n);r>.01&&e.addBall(o.x,o.y,o.z,r,te)}for(let r=0;r<t;r++){if(x[r]===void 0||n<x[r]||A[r]===void 0)continue;const i=A[r]/e.scale.x;let s=0,w=n-x[r];if(M.value){switch(p){case"growing":if(i>.001){const u=a.growth.speed*a.growth.flowSpeedFactor,v=i/(u/e.scale.x),B=v>0?Math.min(w/v,1):1;s=Math.pow(B,a.growth.easeOutPower)*i}else s=0;break;case"pauseAtEnd":s=i;break;case"shrinking":if(g!==null&&y!==null){const u=y-g,v=n-g,B=Math.min(v/u,1),L=Math.max(0,1-B);s=i*L}else s=i;break;case"pauseAtStart":s=.001;break;default:s=0;break}V[r]=p}else if(i>.001){const u=Math.min(w/(i/(a.growth.speed/e.scale.x)),1);s=Math.pow(u,a.growth.easeOutPower)*i}else s=0;if(s<=.001)continue;const k=T[r],S=z[r];if(!(!k||!S))for(let u=0;u<=ee;u++){const v=u/ee,B=Math.pow(v,S==="tt"?.25:1.25),L=j.lerp(S==="tt"?.1:.01,S==="tt"?.01:.1,B);let I=L;if(M.value){const fe=a.wave.amplitudeFactor*L,ge=Math.sin(n*a.wave.frequency-v*a.wave.phaseFactor)*fe;I+=ge,I=Math.max(I,0)}const G=k.clone().multiplyScalar(s*v).add(o);e.addBall(G.x,G.y,G.z,I,te)}}e.update()}function se(){var o;if(!c)return;const e=c.getElapsedTime(),n=z.length;console.log("所有線條同步生長"),p="growing",Q=e,U=!1,q=null,D.forEach(t=>{t.startTime=e,t.active=!0,t.mesh.position.set(0,0,0),t.direction=d.random.direction()});for(let t=0;t<n;t++){if(x[t]===void 0)continue;T[t]||(T[t]=new O),(o=T[t])==null||o.copy(d.random.direction());const r=2,i=3.5;A[t]=j.randFloat(r,i),x[t]=e}}function le(){if(!c)return;const e=c.getElapsedTime();console.log("所有線條同步收合"),p="shrinking",g=e,y=e+a.timing.baseShrinkDuration*a.timing.flowShrinkDurationFactor,U=!0}function ce(e){if(!c)return 0;if(e===void 0&&(e=c.getElapsedTime()),p==="shrinking"){if(g===null||y===null)return 0;const n=y-g,o=e-g,t=Math.min(o/n,1);return a.centerBall.minStrength+t*(a.centerBall.maxStrength-a.centerBall.minStrength)}else if(p==="pauseAtStart"){if(q===null)return q=e,a.centerBall.maxStrength;const n=e-q,o=Math.min(n/a.centerBall.fadeDuration,1);let t;switch(a.centerBall.fadeEasing.type){case"easeIn":t=Math.pow(o,a.centerBall.fadeEasing.power);break;case"easeOut":t=1-Math.pow(1-o,a.centerBall.fadeEasing.power);break;case"linear":default:t=o;break}return a.centerBall.maxStrength*(1-t)}else return a.centerBall.minStrength}const d={random:{float:(e,n)=>Math.random()*(n-e)+e,vector:e=>new O((Math.random()-.5)*2*e,(Math.random()-.5)*2*e,(Math.random()-.5)*2*e),direction:()=>d.random.vector(1).normalize()},material:{getBaseConfig:()=>({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.33,thickness:1,envMapIntensity:50,side:Y}),generateMaterials:(e,n)=>({shader:new we({uniforms:{uResolution:{value:new Ae(window.innerWidth,window.innerHeight)},uTime:{value:0},uColor:{value:new Te(0)},viewVector:{value:e.position}},vertexShader:Ue,fragmentShader:Ge,transparent:!0,side:Y}),liquid:new K({...d.material.getBaseConfig(),envMap:(n==null?void 0:n.environment)||null})})},sphere:{generateProperties:()=>({radius:d.random.float(a.shootingSpheres.size.min,a.shootingSpheres.size.max),speed:d.random.float(a.shootingSpheres.speed.base-a.shootingSpheres.speed.variation,a.shootingSpheres.speed.base+a.shootingSpheres.speed.variation),maxDistance:d.random.float(a.shootingSpheres.distance.min,a.shootingSpheres.distance.max)})},scene:{initialize:e=>{const n=e.clientWidth,o=e.clientHeight,t=new xe;t.background=null;const r=new ye(a.camera.fov,n/o,a.camera.near,a.camera.far);r.position.set(a.camera.position.x,a.camera.position.y,a.camera.position.z),r.lookAt(0,0,0);const i=new Me({antialias:a.renderer.antialias,alpha:a.renderer.alpha});i.setSize(n,o),i.setPixelRatio(Math.min(window.devicePixelRatio,a.renderer.pixelRatio)),e.appendChild(i.domElement);const s=new Pe(r,i.domElement);s.enableDamping=a.controls.enableDamping,s.autoRotate=ne.value,s.autoRotateSpeed=a.controls.autoRotateSpeed,s.enablePan=a.controls.enablePan,s.enableZoom=a.controls.enableZoom,s.minPolarAngle=a.controls.polarAngle,s.maxPolarAngle=a.controls.polarAngle,s.minAzimuthAngle=-1/0,s.maxAzimuthAngle=1/0,t.add(new ke(16777215,.3));const w=new Ee(16777215,.5);return w.position.set(5,10,7.5),t.add(w),{scene:t,camera:r,renderer:i,controls:s}},cleanup:(e,n,o,t,r,i)=>{var s,w;R&&R.dispose(),n&&(n.dispose(),i==null||i.removeChild(n.domElement)),o&&((s=o.shader)==null||s.dispose(),(w=o.liquid)==null||w.dispose(),e!=null&&e.environment&&e.environment.dispose()),t&&(e==null||e.remove(t)),e&&e.traverse(k=>{var S;if(k instanceof $){(S=k.geometry)==null||S.dispose();const u=k.material;Array.isArray(u)?u.forEach(v=>v.dispose()):u&&u.dispose()}}),r&&r.dispose()}}};function ue(e){!M.value||!c||D.forEach(n=>{if(!n.active)return;const o=de(n,e);me(n,o)})}function de(e,n){const o=n-e.startTime;switch(p){case"growing":const t=Math.min(o/(e.properties.maxDistance/e.properties.speed),1);return Math.pow(t,a.growth.easeOutPower);case"shrinking":if(g!==null&&y!==null){const r=y-g,i=n-g;return 1-Math.min(i/r,1)}return 1;case"pauseAtEnd":return 1;case"pauseAtStart":default:return 0}}function me(e,n){const o=e.direction.clone().multiplyScalar(e.properties.maxDistance*n);e.mesh.position.copy(o)}function pe(){he();for(let e=0;e<a.shootingSpheres.count;e++){const n=d.sphere.generateProperties(),o=new ze(n.radius,a.shootingSpheres.geometry.segments,a.shootingSpheres.geometry.rings),t=new K({...d.material.getBaseConfig(),envMap:h.environment}),r=new $(o,t),i=d.random.vector(a.shootingSpheres.spawnArea.radius);r.position.copy(i),D.push({mesh:r,direction:d.random.direction(),startTime:null,active:!1,properties:n}),h.add(r)}}function he(){D.forEach(e=>{e.mesh&&(h.remove(e.mesh),e.mesh.geometry.dispose(),e.mesh.material.dispose())}),D=[]}function Z(){if(X=requestAnimationFrame(Z),!l||!m||!f||!P||!h||!R)return;const e=c.getElapsedTime();re(l),ue(e),R.update(),W.value==="shader"&&!H.value&&(m.shader.uniforms.uTime.value=e,m.shader.uniforms.viewVector.value=f.position),H.value&&E?E.render():P.render(h,f)}function J(){var o,t;if(!f||!P||!m)return;const e=((o=b.value)==null?void 0:o.clientWidth)??window.innerWidth,n=((t=b.value)==null?void 0:t.clientHeight)??window.innerHeight;f.aspect=e/n,f.updateProjectionMatrix(),P.setSize(e,n),E&&E.setSize(e,n),m.shader&&m.shader.uniforms.uResolution.value.set(e,n)}return _e(()=>{if(!b.value){console.error("Canvas container not found!");return}const{scene:e,camera:n,renderer:o,controls:t}=d.scene.initialize(b.value);h=e,f=n,P=o,R=t,F=new ve(P),F.compileEquirectangularShader(),m=d.material.generateMaterials(f,h),l=new Se(200,m[W.value],!0,!0,1e5),l.isolation=300,l.scale.set(8,8,8),l.enableUvs=!1,l.enableColors=!1,h.add(l),E=new Fe(P),N=new Be(5,h,f),E.addPass(N);const r=new Le;if(E.addPass(r),c=new Re,ae(),pe(),Z(),M.value){console.log("初始化流動動畫狀態...");const i=c.getElapsedTime();f.position.clone(),f.quaternion.clone(),p="growing",Q=i,D.forEach(s=>{s.startTime=i,s.active=!0,s.mesh.position.set(0,0,0),s.direction.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize()}),oe()}window.addEventListener("resize",J)}),qe(()=>{cancelAnimationFrame(X),window.removeEventListener("resize",J),d.scene.cleanup(h,P,m,l,F,b.value),console.log("Three.js scene cleaned up.")}),(e,n)=>(Ve(),Ie(Oe,null,[n[0]||(n[0]=C("div",{class:"main-container"},[C("h1",{class:"company-name"},[C("div",{class:"front-name"}," Splash "),C("div",{class:"back-name"}," DigiLab ")])],-1)),C("div",Qe,[C("div",{ref_key:"canvasContainer",ref:b,class:"canvas-container"},null,512)])],64))}};export{Je as default};
