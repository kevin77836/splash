import{S as _e,P as Me,W as ke,O as Pe,a as xe,M as Ae,E as Fe,f as Te,b as Ee,j as Ce,e as ye,g as N,h as $,i as be}from"./GFrmpgK8.js";import{_ as oe,r as z,S as Q,o as De,I as ie,t as ae,v as se,x,z as ze,y as Y,K as Z,O as Ge}from"./iXxArwze.js";const Re={class:"splash-container"},We={__name:"Splash1",emits:["stateChange","animationComplete","resourcesLoaded"],setup(re,{expose:F,emit:H}){const T=H,m=z(null),f=z(!1),r=Q({startStrength:.1,endStrength:.01,minLength:2.5,maxLength:3.5,shrinkPower:.25,numLines:4}),l=Q({startStrength:.01,endStrength:.1,minLength:2,maxLength:3,shrinkPower:1.25,numLines:3}),s=Q({resolution:200,growthSpeed:5,growthEaseOutPower:.15,numSegments:50,subtract:20,flowGrowthSpeedFactor:.1,flowWaveAmplitudeFactorAtStart:1,flowShrinkDurationFactor:.2,baseShrinkDuration:3,flowWaveFrequency:1,flowWaveAmplitudeFactor:.15,flowWavePhaseFactor:Math.PI*4});let c=null,p=null,u=null,L=null,a=null,w=null,_=null,C=null,j=null,S=[],v=[],A=[],E=[],M=[],G=null,R=null,ee=null,h="idle";function le(){return new Ce({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.5,thickness:1,envMapIntensity:300,side:ye})}function ce(){return new Promise((t,n)=>{new Fe().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=Te;const o=C.fromEquirectangular(e).texture;C.dispose(),e.dispose(),console.log("環境貼圖已載入"),c.environment=o,_&&(_.envMap=o,_.needsUpdate=!0),t(o)},void 0,e=>{console.error("無法載入環境貼圖:",e),n(e)})})}function ue(){var o,d;if(!w||!a)return;const t=w.getElapsedTime(),n=r.numLines+l.numLines;S.length=n,v.length=n,A.length=n,E.length=n,M.length=n;let e=0;for(let i=0;i<r.numLines;i++)v[e]||(v[e]=new N),(o=v[e])==null||o.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),A[e]=$.randFloat(r.minLength,r.maxLength),E[e]="tt",S[e]=t,h?M[e]=h:M[e]="growing",e++;for(let i=0;i<l.numLines;i++)v[e]||(v[e]=new N),(d=v[e])==null||d.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),A[e]=$.randFloat(l.minLength,l.maxLength),E[e]="th",S[e]=t,h?M[e]=h:M[e]="growing",e++;a.reset()}function de(t){if(!w)return;t.reset();const n=w.getElapsedTime(),e=new N(.5,.5,.5),o=r.numLines+l.numLines;me(n);for(let d=0;d<o;d++){if(S[d]===void 0||n<S[d]||A[d]===void 0)continue;const i=A[d]/t.scale.x;let g=0,I=n-S[d];if(h==="pauseAtStart")g=.05;else if(h==="pauseAtEnd")g=i;else if(h==="growing")if(i>.001){const k=s.growthSpeed*s.flowGrowthSpeedFactor,P=i/(k/t.scale.x),B=P>0?Math.min(I/P,1):1;g=Math.pow(B,s.growthEaseOutPower)*i}else g=0;else if(h==="shrinking")if(G!==null&&R!==null){const k=R-G,P=n-G,B=Math.min(P/k,1),y=Math.max(0,1-B),b=s.growthSpeed*s.flowGrowthSpeedFactor,D=i/(b/t.scale.x),J=D>0?Math.min(I/D,1):1;g=Math.pow(J,s.growthEaseOutPower)*i*y}else g=i;else if(i>.001){const k=Math.min(I/(i/(s.growthSpeed/t.scale.x)),1);g=Math.pow(k,s.growthEaseOutPower)*i}else g=0;if(g<=.001)continue;const U=v[d],O=E[d];if(!U||!O)continue;let q,K,X;O==="tt"?(q=r.startStrength,K=r.endStrength,X=r.shrinkPower):(q=l.startStrength,K=l.endStrength,X=l.shrinkPower);for(let k=0;k<=s.numSegments;k++){const P=k/s.numSegments,B=Math.pow(P,X),y=$.lerp(q,K,B);let b=y,D;h==="pauseAtStart"?D=s.flowWaveAmplitudeFactorAtStart*y:D=s.flowWaveAmplitudeFactor*y;const J=Math.sin(n*s.flowWaveFrequency-P*s.flowWavePhaseFactor)*D;b+=J,b=Math.max(b,0);const V=U.clone().multiplyScalar(g*P).add(e);t.addBall(V.x,V.y,V.z,b,s.subtract)}}t.update()}function me(t){if(w)if(h==="growing"&&ee!==null){const n=r.numLines+l.numLines;let e=0,o=0;for(let i=0;i<n;i++){if(S[i]===void 0||A[i]===void 0)continue;o++;const g=A[i]/((a==null?void 0:a.scale.x)||1),I=t-(S[i]||t),U=s.growthSpeed*s.flowGrowthSpeedFactor,O=g/(U/((a==null?void 0:a.scale.x)||1)),q=O>0?Math.min(I/O,1):1;e+=q}(o>0?e/o:0)>=.99&&W("pauseAtEnd")}else h==="shrinking"&&G!==null&&R!==null&&t>=R&&W("pauseAtStart")}function he(){if(!w)return;const t=w.getElapsedTime();console.log("所有線條同步收合"),W("shrinking"),G=t,R=t+s.baseShrinkDuration*s.flowShrinkDurationFactor;const n=r.numLines+l.numLines;for(let e=0;e<n;e++)S[e]!==void 0&&(M[e]="shrinking")}function fe(){var e;if(!w)return;const t=w.getElapsedTime(),n=r.numLines+l.numLines;console.log("所有線條同步生長"),W("growing"),ee=t;for(let o=0;o<n;o++){if(S[o]===void 0)continue;v[o]||(v[o]=new N),(e=v[o])==null||e.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),E[o]=o<r.numLines?"tt":"th";const d=E[o]==="tt"?r.minLength:l.minLength,i=E[o]==="tt"?r.maxLength:l.maxLength;A[o]=$.randFloat(d,i),S[o]=t,M[o]="growing"}}function te(){j=requestAnimationFrame(te),!(!a||!_||!p||!u||!c||!L)&&(de(a),L.update(),u.render(c,p))}function ne(){var e,o;if(!p||!u)return;const t=((e=m.value)==null?void 0:e.clientWidth)??window.innerWidth,n=((o=m.value)==null?void 0:o.clientHeight)??window.innerHeight;p.aspect=t/n,p.updateProjectionMatrix(),u.setSize(t,n)}function ge(){if(!m.value)return console.error("Canvas container not found!"),!1;const t=m.value,n=t.clientWidth,e=t.clientHeight;c=new _e,c.background=null,p=new Me(45,n/e,.1,1e3),p.position.set(0,0,30),p.lookAt(c.position),u=new ke({antialias:!0,alpha:!0}),u.setSize(n,e),u.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),t.appendChild(u.domElement),L=new Pe(p,u.domElement),L.enableDamping=!0,L.autoRotate=!0,L.autoRotateSpeed=2,C=new xe(u),C.compileEquirectangularShader(),_=le();const o=s.resolution*1.5;return a=new Ae(s.resolution,_,!0,!0,1e5),a.isolation=o,a.scale.set(8,8,8),a.enableUvs=!1,a.enableColors=!1,c.add(a),w=new be,!0}function pe(){cancelAnimationFrame(j),window.removeEventListener("resize",ne),L&&L.dispose(),u&&u.dispose(),_&&(_.dispose(),c!=null&&c.environment&&c.environment.dispose()),a&&(c==null||c.remove(a)),c&&c.traverse(t=>{var n;if(t instanceof Ee){(n=t.geometry)==null||n.dispose();const e=t.material;Array.isArray(e)?e.forEach(o=>o.dispose()):e&&e.dispose()}}),C&&C.dispose(),m.value&&u&&m.value.removeChild(u.domElement),console.log("Three.js場景已清理")}function we(){f.value==!1&&(f.value=!0,h="growing",fe())}function Se(){f.value==!0&&(f.value=!1,h="shrinking",he())}function ve(){W("pauseAtStart"),ue();const t=r.numLines+l.numLines;for(let n=0;n<t;n++)M[n]!==void 0&&(M[n]="pauseAtStart");console.log("初始化完成：線條收合狀態")}function W(t){h=t,T("stateChange",t),t==="pauseAtEnd"?(console.log("所有線條已生長完成，暫停動畫"),T("animationComplete","growing")):t==="pauseAtStart"&&(console.log("所有線條已收合完成，進入起始暫停狀態"),T("animationComplete","shrinking"))}return De(()=>{ge()&&(te(),ce().then(()=>{console.log("環境貼圖載入完成"),ve(),f.value=!1,T("resourcesLoaded",!0)}).catch(t=>{console.error("環境貼圖載入失敗:",t)}),window.addEventListener("resize",ne))}),ie(()=>{pe()}),F({startGrowingAnimation:we,startShrinkingAnimation:Se}),(t,n)=>(se(),ae("div",Re,[x("div",{ref_key:"canvasContainer",ref:m,class:"canvas-container"},null,512)]))}},Ie=oe(We,[["__scopeId","data-v-774b0df8"]]),Oe={class:"button-group"},qe={class:"status"},Be={class:"status"},He={class:"status"},Ue={__name:"ver2-5",setup(re){const F=z(null),H=z(!1),T=z("idle"),m=z(!1);let f=null;const r=()=>{F.value&&F.value.startGrowingAnimation()},l=()=>{F.value&&F.value.startShrinkingAnimation()},s=()=>{H.value=!0,console.log("資源載入完成，開始自動播放"),u()},c=a=>{T.value=a},p=a=>{m.value&&(a==="growing"?f=setTimeout(()=>{l()},1e3):a==="shrinking"&&(f=setTimeout(()=>{r()},1e3)))},u=()=>{m.value||(m.value=!0,r())},L=()=>{m.value=!1,f&&(clearTimeout(f),f=null),l()};return ie(()=>{f&&clearTimeout(f),m.value=!1}),(a,w)=>{const _=Ie;return se(),ae(Ge,null,[ze(_,{ref_key:"splashRef",ref:F,onResourcesLoaded:s,onStateChange:c,onAnimationComplete:p},null,512),x("div",Oe,[x("button",{onClick:r},"開始生長"),x("button",{onClick:l},"開始收合"),x("button",{onClick:u},"開始自動播放"),x("button",{onClick:L},"停止自動播放"),x("div",qe,"狀態: "+Y(Z(T)),1),x("div",Be,"資源狀態: "+Y(Z(H)?"已載入":"載入中"),1),x("div",He,"自動播放: "+Y(Z(m)?"進行中":"停止"),1)])],64)}}},$e=oe(Ue,[["__scopeId","data-v-22256174"]]);export{$e as default};
