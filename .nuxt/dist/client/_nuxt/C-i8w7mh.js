import{S as ge,P as we,W as pe,O as Se,a as Le,M as ve,E as Me,f as ke,b as Pe,j as xe,e as Ee,g as I,h as O,i as Fe}from"./GFrmpgK8.js";import{r as q,j as Te,T as K,o as Ae,I as ye,t as _e,x as Z,y as De,K as $,v as be}from"./DzvUFI15.js";const ze={class:"splash-container"},Ce=["disabled"],Be={__name:"ver2-4",setup(Ge){const x=q(null),j=q(null),N=q(!1),W=q(!1),ee=Te(()=>W.value?"返回":"播放"),c=K({startStrength:.1,endStrength:.01,minLength:2.5,maxLength:3.5,shrinkPower:.25,numLines:4}),d=K({startStrength:.01,endStrength:.1,minLength:2,maxLength:3,shrinkPower:1.25,numLines:3}),a=K({resolution:200,growthSpeed:5,growthEaseOutPower:.15,numSegments:50,subtract:20,flowGrowthSpeedFactor:.1,flowWaveAmplitudeFactorAtStart:.5,flowShrinkDurationFactor:.2,baseShrinkDuration:3,flowWaveFrequency:1,flowWaveAmplitudeFactor:.15,flowWavePhaseFactor:Math.PI*4});let l=null,p=null,h=null,M=null,r=null,w=null,k=null,F=null,X=null,f=[],g=[],P=[],E=[],S=[],_=null,D=null,J=null,s="idle";function ne(){return new xe({color:16777215,metalness:0,roughness:0,transparent:!0,opacity:.75,transmission:1,ior:1.5,thickness:1,envMapIntensity:100,side:Ee})}function te(){return new Promise((n,t)=>{new Me().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=ke;const o=F.fromEquirectangular(e).texture;F.dispose(),e.dispose(),console.log("環境貼圖已載入"),l.environment=o,k&&(k.envMap=o,k.needsUpdate=!0),n(o)},void 0,e=>{console.error("無法載入環境貼圖:",e),t(e)})})}function oe(){var o,u;if(!w||!r)return;const n=w.getElapsedTime(),t=c.numLines+d.numLines;f.length=t,g.length=t,P.length=t,E.length=t,S.length=t;let e=0;for(let i=0;i<c.numLines;i++)g[e]||(g[e]=new I),(o=g[e])==null||o.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),P[e]=O.randFloat(c.minLength,c.maxLength),E[e]="tt",f[e]=n,s?S[e]=s:S[e]="growing",e++;for(let i=0;i<d.numLines;i++)g[e]||(g[e]=new I),(u=g[e])==null||u.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),P[e]=O.randFloat(d.minLength,d.maxLength),E[e]="th",f[e]=n,s?S[e]=s:S[e]="growing",e++;r.reset()}function ie(n){if(!w)return;n.reset();const t=w.getElapsedTime(),e=new I(.5,.5,.5),o=c.numLines+d.numLines;ae(t);for(let u=0;u<o;u++){if(f[u]===void 0||t<f[u]||P[u]===void 0)continue;const i=P[u]/n.scale.x;let m=0,b=t-f[u];if(s==="pauseAtStart")m=.05;else if(s==="pauseAtEnd")m=i;else if(s==="growing")if(i>.001){const L=a.growthSpeed*a.flowGrowthSpeedFactor,v=i/(L/n.scale.x),G=v>0?Math.min(b/v,1):1;m=Math.pow(G,a.growthEaseOutPower)*i}else m=0;else if(s==="shrinking")if(_!==null&&D!==null){const L=D-_,v=t-_,G=Math.min(v/L,1),T=Math.max(0,1-G),A=a.growthSpeed*a.flowGrowthSpeedFactor,y=i/(A/n.scale.x),V=y>0?Math.min(b/y,1):1;m=Math.pow(V,a.growthEaseOutPower)*i*T}else m=i;else if(i>.001){const L=Math.min(b/(i/(a.growthSpeed/n.scale.x)),1);m=Math.pow(L,a.growthEaseOutPower)*i}else m=0;if(m<=.001)continue;const R=g[u],z=E[u];if(!R||!z)continue;let C,H,U;z==="tt"?(C=c.startStrength,H=c.endStrength,U=c.shrinkPower):(C=d.startStrength,H=d.endStrength,U=d.shrinkPower);for(let L=0;L<=a.numSegments;L++){const v=L/a.numSegments,G=Math.pow(v,U),T=O.lerp(C,H,G);let A=T,y;s==="pauseAtStart"?y=a.flowWaveAmplitudeFactorAtStart*T:y=a.flowWaveAmplitudeFactor*T;const V=Math.sin(t*a.flowWaveFrequency-v*a.flowWavePhaseFactor)*y;A+=V,A=Math.max(A,0);const B=R.clone().multiplyScalar(m*v).add(e);n.addBall(B.x,B.y,B.z,A,a.subtract)}}n.update()}function ae(n){if(w)if(s==="growing"&&J!==null){const t=c.numLines+d.numLines;let e=0,o=0;for(let i=0;i<t;i++){if(f[i]===void 0||P[i]===void 0)continue;o++;const m=P[i]/((r==null?void 0:r.scale.x)||1),b=n-(f[i]||n),R=a.growthSpeed*a.flowGrowthSpeedFactor,z=m/(R/((r==null?void 0:r.scale.x)||1)),C=z>0?Math.min(b/z,1):1;e+=C}(o>0?e/o:0)>=.99&&(s="pauseAtEnd",console.log("所有線條已生長完成，暫停動畫"))}else s==="shrinking"&&_!==null&&D!==null&&n>=D&&(s="pauseAtStart",console.log("所有線條已收合完成，進入起始暫停狀態"))}function re(){if(!w)return;const n=w.getElapsedTime();console.log("所有線條同步收合"),s="shrinking",_=n,D=n+a.baseShrinkDuration*a.flowShrinkDurationFactor;const t=c.numLines+d.numLines;for(let e=0;e<t;e++)f[e]!==void 0&&(S[e]="shrinking")}function se(){var e;if(!w)return;const n=w.getElapsedTime(),t=c.numLines+d.numLines;console.log("所有線條同步生長"),s="growing",J=n;for(let o=0;o<t;o++){if(f[o]===void 0)continue;g[o]||(g[o]=new I),(e=g[o])==null||e.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize(),E[o]=o<c.numLines?"tt":"th";const u=E[o]==="tt"?c.minLength:d.minLength,i=E[o]==="tt"?c.maxLength:d.maxLength;P[o]=O.randFloat(u,i),f[o]=n,S[o]="growing"}}function Q(){X=requestAnimationFrame(Q),!(!r||!k||!p||!h||!l||!M)&&(ie(r),M.update(),h.render(l,p))}function Y(){var e,o;if(!p||!h)return;const n=((e=x.value)==null?void 0:e.clientWidth)??window.innerWidth,t=((o=x.value)==null?void 0:o.clientHeight)??window.innerHeight;p.aspect=n/t,p.updateProjectionMatrix(),h.setSize(n,t)}function le(){if(!x.value)return console.error("Canvas container not found!"),!1;const n=x.value,t=n.clientWidth,e=n.clientHeight;l=new ge,l.background=null,p=new we(45,t/e,.1,1e3),p.position.set(0,0,30),p.lookAt(l.position),h=new pe({antialias:!0,alpha:!0}),h.setSize(t,e),h.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),n.appendChild(h.domElement),M=new Se(p,h.domElement),M.enableDamping=!0,M.autoRotate=!0,M.autoRotateSpeed=2,F=new Le(h),F.compileEquirectangularShader(),k=ne();const o=a.resolution*1.5;return r=new ve(a.resolution,k,!0,!0,1e5),r.isolation=o,r.scale.set(8,8,8),r.enableUvs=!1,r.enableColors=!1,l.add(r),w=new Fe,!0}function ce(){cancelAnimationFrame(X),window.removeEventListener("resize",Y),M&&M.dispose(),h&&h.dispose(),k&&(k.dispose(),l!=null&&l.environment&&l.environment.dispose()),r&&(l==null||l.remove(r)),l&&l.traverse(n=>{var t;if(n instanceof Pe){(t=n.geometry)==null||t.dispose();const e=n.material;Array.isArray(e)?e.forEach(o=>o.dispose()):e&&e.dispose()}}),F&&F.dispose(),x.value&&h&&x.value.removeChild(h.domElement),console.log("Three.js場景已清理")}function ue(){W.value?(W.value=!1,console.log("返回按鈕被點擊，立即開始收合動畫"),he()):(W.value=!0,console.log("播放按鈕被點擊，立即開始生長動畫"),de())}function de(){s="growing",se()}function he(){s="shrinking",re()}function me(){s="pauseAtStart",oe();const n=c.numLines+d.numLines;for(let t=0;t<n;t++)S[t]!==void 0&&(S[t]="pauseAtStart");console.log("初始化完成：線條收合狀態")}return Ae(()=>{le()&&(Q(),te().then(()=>{console.log("環境貼圖載入完成"),me(),N.value=!0}).catch(n=>{console.error("環境貼圖載入失敗:",n)}),window.addEventListener("resize",Y))}),ye(()=>{ce()}),(n,t)=>(be(),_e("div",ze,[Z("div",{ref_key:"canvasContainer",ref:x,class:"canvas-container"},null,512),Z("button",{ref_key:"controlButton",ref:j,class:"control-button",disabled:!$(N),onClick:ue},De($(ee)),9,Ce)]))}};export{Be as default};
