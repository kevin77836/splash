import{S as ie,P as oe,W as se,O as le,A as ce,D as ue,a as de,M as fe,E as me,f as he,b as pe,c as ge,e as we,g as _,Q as Se,i as Me,h as C}from"./GFrmpgK8.js";import{r as ve,o as Ee,I as Te,t as ye,x as De,v as Pe}from"./iXxArwze.js";const xe={class:"splash-container"},G=50,Q=20,Be={__name:"loadJson-1",setup(Ae){const E=ve(null);let i,m,c,w,a,u,f,P,q,h=[],T=[],y=[],x=[],L=[],S=null,D=null,F=null,k=null,d="idle";const o={centerBall:{maxStrength:1,minStrength:0,fadeDuration:5,fadeEasing:{type:"easeIn",power:.5}},timing:{baseShrinkDuration:3,flowShrinkDurationFactor:.2},growth:{speed:5,easeOutPower:.15,flowSpeedFactor:.1},wave:{frequency:1,amplitudeFactor:.3,phaseFactor:Math.PI*4}};function b(){return new ge({color:16777215,metalness:1,roughness:0,transparent:!0,opacity:.25,side:we,envMap:null})}function U(){new me().setPath("/hdr/").load("HDR_Light_Studio_Free_HDRI_Design_04.exr",e=>{e.mapping=he;const t=P.fromEquirectangular(e).texture;P.dispose(),e.dispose(),console.log("環境貼圖已載入"),i.environment=t,f&&f.liquid&&(f.liquid.envMap=t,f.liquid.needsUpdate=!0)},void 0,e=>{console.error("無法載入環境貼圖:",e)})}function O(e){if(!u)return;e.reset();const t=u.getElapsedTime(),r=new _(.5,.5,.5),n=x.length;Z(t);const s=W(t);s>.01&&e.addBall(r.x,r.y,r.z,s,Q);for(let l=0;l<n;l++){if(!H(l,t))continue;const M=y[l]/e.scale.x,p=t-h[l],g=N(M,p,e.scale.x);if(g<=.001)continue;const v=T[l],A=x[l];!v||!A||J(e,g,v,A,r,t)}e.update()}function W(e){if(d==="shrinking"){if(S===null||D===null)return 0;const t=D-S,r=e-S,n=Math.min(r/t,1);return o.centerBall.minStrength+n*(o.centerBall.maxStrength-o.centerBall.minStrength)}else if(d==="pauseAtStart"){if(k===null)return k=e,o.centerBall.maxStrength;const t=e-k,r=Math.min(t/o.centerBall.fadeDuration,1),n=I(r,o.centerBall.fadeEasing);return o.centerBall.maxStrength*(1-n)}return o.centerBall.minStrength}function I(e,t){switch(t.type){case"easeIn":return Math.pow(e,t.power);case"easeOut":return 1-Math.pow(1-e,t.power);default:return e}}function H(e,t){return h[e]!==void 0&&t>=h[e]&&y[e]!==void 0}function N(e,t,r){if(e<=.001)return 0;switch(d){case"growing":const n=o.growth.speed*o.growth.flowSpeedFactor,s=e/(n/r),l=s>0?Math.min(t/s,1):1;return Math.pow(l,o.growth.easeOutPower)*e;case"pauseAtEnd":return e;case"shrinking":if(S!==null&&D!==null){const p=u.getElapsedTime(),g=D-S,v=p-S,A=Math.min(v/g,1);return e*(1-A)}return e;case"pauseAtStart":return .001;default:return 0}}function J(e,t,r,n,s,l){for(let M=0;M<=G;M++){const p=M/G,g=Math.pow(p,n==="tt"?.25:1.25),v=C.lerp(n==="tt"?.1:.01,n==="tt"?.01:.1,g);let A=V(v,p,l);const B=r.clone().multiplyScalar(t*p).add(s);e.addBall(B.x,B.y,B.z,A,Q)}}function V(e,t,r){const n=o.wave.amplitudeFactor*e,s=Math.sin(r*o.wave.frequency-t*o.wave.phaseFactor)*n;return Math.max(e+s,0)}function X(){fetch("/modelJson.json").then(e=>e.json()).then(e=>{console.log("模型設定已載入"),K(e),Y(e),ne()}).catch(e=>{console.error("載入模型設定失敗:",e)})}function K(e){const t=e.lineTypes.length;h=new Array(t),T=new Array(t),y=new Array(t),x=new Array(t),L=new Array(t);const r=(u==null?void 0:u.getElapsedTime())??0;for(let n=0;n<t;n++)x[n]=e.lineTypes[n],y[n]=e.currentTargetLengths[n],e.randomDirections[n]?T[n]=new _(e.randomDirections[n].x,e.randomDirections[n].y,e.randomDirections[n].z):T[n]=null,h[n]=r-1e3,L[n]="growing"}function Y(e){if(!a||!e.cameraQuaternion)return;const t=new Se(e.cameraQuaternion.x,e.cameraQuaternion.y,e.cameraQuaternion.z,e.cameraQuaternion.w);a.quaternion.set(0,0,0,1);const r=t.clone().invert();a.quaternion.premultiply(r),a.matrixWorldNeedsUpdate=!0,a.updateMatrixWorld(!0),a.matrixAutoUpdate=!1}function Z(e){d==="growing"&&F!==null?$(e)>=.99&&(d="pauseAtEnd",console.log("線條生長完成，進入暫停狀態"),setTimeout(j,1e3)):d==="shrinking"&&S!==null&&D!==null&&e>=D&&(d="pauseAtStart",console.log("線條收縮完成，進入起始暫停狀態"),setTimeout(ee,1e3));for(let t=0;t<L.length;t++)L[t]=d}function $(e){const t=x.length;let r=0,n=0;for(let s=0;s<t;s++){if(h[s]===void 0||y[s]===void 0)continue;n++;const l=y[s]/((a==null?void 0:a.scale.x)||1),M=e-(h[s]||e),p=o.growth.speed*o.growth.flowSpeedFactor,g=l/(p/((a==null?void 0:a.scale.x)||1)),v=g>0?Math.min(M/g,1):1;r+=v}return n>0?r/n:0}function j(){if(!u)return;console.log("開始收縮動畫，顯示中心球體"),d="shrinking";const e=u.getElapsedTime();S=e,D=e+o.timing.baseShrinkDuration*o.timing.flowShrinkDurationFactor,k=null}function ee(){if(!u)return;console.log("開始生長動畫，隱藏中心球體");const e=u.getElapsedTime();d="growing",F=e,k=null,te(e)}function te(e){var r;const t=x.length;for(let n=0;n<t;n++){if(h[n]===void 0)continue;T[n]||(T[n]=new _),(r=T[n])==null||r.set(Math.random()*2-1,Math.random()*2-1,Math.random()*2-1).normalize();const s=2,l=3.5;y[n]=C.randFloat(s,l),h[n]=e}}function ne(){u&&(console.log("初始化流動動畫"),d="growing",F=u.getElapsedTime(),a&&a.reset())}function R(){q=requestAnimationFrame(R),!(!a||!f||!m||!c||!i||!w)&&(O(a),w.update(),c.render(i,m))}function z(){var r,n;if(!m||!c)return;const e=((r=E.value)==null?void 0:r.clientWidth)??window.innerWidth,t=((n=E.value)==null?void 0:n.clientHeight)??window.innerHeight;m.aspect=e/t,m.updateProjectionMatrix(),c.setSize(e,t)}function re(){if(!E.value)return console.error("找不到畫布容器!"),!1;const e=E.value,t=e.clientWidth,r=e.clientHeight;i=new ie,i.background=null,m=new oe(45,t/r,.1,1e3),m.position.set(0,0,30),m.lookAt(i.position),c=new se({antialias:!0,alpha:!0}),c.setSize(t,r),c.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),e.appendChild(c.domElement),w=new le(m,c.domElement),w.enableDamping=!0,w.autoRotate=!0,w.autoRotateSpeed=5,i.add(new ce(16777215,.3));const n=new ue(16777215,.5);return n.position.set(5,10,7.5),i.add(n),P=new de(c),P.compileEquirectangularShader(),f={liquid:b()},a=new fe(200,f.liquid,!0,!0,1e5),a.isolation=300,a.scale.set(8,8,8),a.enableUvs=!1,a.enableColors=!1,i.add(a),u=new Me,!0}function ae(){cancelAnimationFrame(q),window.removeEventListener("resize",z),w&&w.dispose(),c&&c.dispose(),f&&f.liquid&&(f.liquid.dispose(),i!=null&&i.environment&&i.environment.dispose()),a&&(i==null||i.remove(a)),i&&i.traverse(e=>{var t;if(e instanceof pe){(t=e.geometry)==null||t.dispose();const r=e.material;Array.isArray(r)?r.forEach(n=>n.dispose()):r&&r.dispose()}}),P&&P.dispose(),E.value&&c&&E.value.removeChild(c.domElement),console.log("Three.js 場景已清理")}return Ee(()=>{re()&&(U(),X(),R(),window.addEventListener("resize",z))}),Te(()=>{ae()}),(e,t)=>(Pe(),ye("div",xe,[De("div",{ref_key:"canvasContainer",ref:E,class:"canvas-container"},null,512)]))}};export{Be as default};
